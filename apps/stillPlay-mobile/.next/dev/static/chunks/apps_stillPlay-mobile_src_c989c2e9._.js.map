{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamabdullahi/Documents/Js_portfolio/stillPlay/microservices/my-workspace/apps/stillPlay-mobile/src/components/MobileFrame.tsx"],"sourcesContent":["import { ReactNode } from \"react\";\n\nexport default function MobileFrame({ children }: { children: ReactNode }) {\n  return (\n    <div className=\"app-root\" suppressHydrationWarning>\n      {children}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;;AAEe,SAAS,YAAY,EAAE,QAAQ,EAA2B;IACvE,qBACE,4NAAC;QAAI,WAAU;QAAW,wBAAwB;kBAC/C;;;;;;AAGP;KANwB"}},
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamabdullahi/Documents/Js_portfolio/stillPlay/microservices/my-workspace/apps/stillPlay-mobile/src/lib/env.ts"],"sourcesContent":["const baseUrl =\n  process.env.NODE_ENV === \"development\"\n    ? \"http://localhost:3000/api\"\n    : \"https://api-gateway-production-dab1.up.railway.app/api\";\n\nexport function getBaseUrl(): string {\n  return baseUrl;\n}\n\nexport function requireBaseUrl(): void {\n  if (!getBaseUrl()) {\n    throw new Error(\n      \"API URL not configured. Set NEXT_PUBLIC_API_BASE_URL in .env.local.\"\n    );\n  }\n}\n\nexport const endpoints = {\n  auth: {\n    requestCode: () => `${getBaseUrl()}/auth/request-code`,\n    verifyCode: () => `${getBaseUrl()}/auth/verify-code`,\n    login: () => `${getBaseUrl()}/auth/login`,\n    register: () => `${getBaseUrl()}/auth/register`,\n    forgotPassword: () => `${getBaseUrl()}/auth/forgot-password`,\n    resetPassword: () => `${getBaseUrl()}/auth/reset-password`,\n  },\n  user: {\n    profile: () => `${getBaseUrl()}/user`,\n  },\n  loans: {\n    wallet: (userId: string) => `${getBaseUrl()}/loans/wallet/${userId}`,\n    list: (userId: string) => `${getBaseUrl()}/loans/list/${userId}`,\n    repayments: (userId: string) => `${getBaseUrl()}/loans/repayments/${userId}`,\n    eligibility: (userId: string) => `${getBaseUrl()}/loans/eligibility/${userId}`,\n    request: () => `${getBaseUrl()}/loans/request`,\n    repay: () => `${getBaseUrl()}/loans/repay`,\n  },\n  files: {\n    upload: () => `${getBaseUrl()}/files/upload`,\n  },\n} as const;\n"],"names":[],"mappings":";;;;;;;;AACE;AADF,MAAM,UACJ,uCACI,8BACA;AAEC,SAAS;IACd,OAAO;AACT;AAEO,SAAS;IACd,IAAI,CAAC;;AAKP;AAEO,MAAM,YAAY;IACvB,MAAM;QACJ,aAAa,IAAM,GAAG,aAAa,kBAAkB,CAAC;QACtD,YAAY,IAAM,GAAG,aAAa,iBAAiB,CAAC;QACpD,OAAO,IAAM,GAAG,aAAa,WAAW,CAAC;QACzC,UAAU,IAAM,GAAG,aAAa,cAAc,CAAC;QAC/C,gBAAgB,IAAM,GAAG,aAAa,qBAAqB,CAAC;QAC5D,eAAe,IAAM,GAAG,aAAa,oBAAoB,CAAC;IAC5D;IACA,MAAM;QACJ,SAAS,IAAM,GAAG,aAAa,KAAK,CAAC;IACvC;IACA,OAAO;QACL,QAAQ,CAAC,SAAmB,GAAG,aAAa,cAAc,EAAE,QAAQ;QACpE,MAAM,CAAC,SAAmB,GAAG,aAAa,YAAY,EAAE,QAAQ;QAChE,YAAY,CAAC,SAAmB,GAAG,aAAa,kBAAkB,EAAE,QAAQ;QAC5E,aAAa,CAAC,SAAmB,GAAG,aAAa,mBAAmB,EAAE,QAAQ;QAC9E,SAAS,IAAM,GAAG,aAAa,cAAc,CAAC;QAC9C,OAAO,IAAM,GAAG,aAAa,YAAY,CAAC;IAC5C;IACA,OAAO;QACL,QAAQ,IAAM,GAAG,aAAa,aAAa,CAAC;IAC9C;AACF"}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamabdullahi/Documents/Js_portfolio/stillPlay/microservices/my-workspace/apps/stillPlay-mobile/src/lib/api.ts"],"sourcesContent":["import { endpoints } from \"./env\";\nimport useAuthStore from \"../store/useAuthStore\";\n\n/**\n * Decode a JWT payload without verifying the signature.\n * Returns null if the token is malformed.\n */\nfunction decodeJwtPayload(token: string): Record<string, unknown> | null {\n  try {\n    const part = token.split(\".\")[1];\n    if (!part) return null;\n    const json = atob(part.replace(/-/g, \"+\").replace(/_/g, \"/\"));\n    return JSON.parse(json) as Record<string, unknown>;\n  } catch {\n    return null;\n  }\n}\n\n/** Returns true if the JWT is missing, malformed, or its `exp` has passed. */\nexport function isTokenExpired(token: string | null | undefined): boolean {\n  if (!token) return true;\n  const payload = decodeJwtPayload(token);\n  if (!payload) return true;\n  const exp = payload.exp;\n  if (typeof exp !== \"number\") return false; // no expiry claim → treat as valid\n  return Date.now() >= exp * 1000;\n}\n\n/**\n * Extract basic identity fields from a JWT without making an API call.\n * Returns null if the token is missing or malformed.\n */\nexport function decodeToken(token: string | null | undefined): {\n  userId: string;\n  email: string;\n  role: string;\n  verified: boolean;\n} | null {\n  if (!token) return null;\n  const payload = decodeJwtPayload(token);\n  if (!payload) return null;\n  return {\n    userId: (payload.userId ?? payload.sub ?? \"\") as string,\n    email: (payload.email ?? \"\") as string,\n    role: (payload.role ?? \"Customer\") as string,\n    verified: Boolean(payload.verified),\n  };\n}\n\nfunction getAuthHeaders(token?: string | null): HeadersInit {\n  const headers: HeadersInit = { \"Content-Type\": \"application/json\" };\n  if (token) {\n    (headers as Record<string, string>)[\"Authorization\"] = `Bearer ${token}`;\n  }\n  return headers;\n}\n\nfunction handleAuthError(res: Response): void {\n  if (res.status === 401) {\n    useAuthStore.getState().reset();\n  }\n}\n\nexport type LoginPayload = {\n  email: string;\n  password: string;\n};\n\nexport type LoginResponse = {\n  token: string;\n  user?: {\n    id: string;\n    email: string;\n    role: string;\n    firstName?: string;\n    lastName?: string;\n    picture?: string | null;\n  };\n};\n\nexport async function login(payload: LoginPayload): Promise<LoginResponse> {\n  const res = await fetch(endpoints.auth.login(), {\n    method: \"POST\",\n    headers: getAuthHeaders(),\n    body: JSON.stringify(payload),\n  });\n  const data = await res.json().catch(() => ({}));\n  handleAuthError(res);\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\"\n        ? data.message\n        : Array.isArray(data.message)\n          ? data.message[0]\n          : \"Invalid email or password\"\n    );\n  }\n  return data as LoginResponse;\n}\n\nexport type UserProfileResponse = {\n  id: string;\n  email: string;\n  role: string;\n  firstName?: string;\n  lastName?: string;\n  picture?: string | null;\n  verified?: boolean;\n  nin?: string | null;\n  ninSlip?: string | null;\n  userNumber?: string;\n  createdAt?: string;\n};\n\nexport type WalletResponse = {\n  id: string;\n  userId: string;\n  balance: number;\n  currency?: string;\n};\n\nexport type LoanStatus =\n  | \"PENDING\"\n  | \"APPROVED\"\n  | \"DISBURSED\"\n  | \"REPAID\"\n  | \"REJECTED\";\n\nexport type LoanItem = {\n  id: string;\n  userId: string;\n  amount: number;\n  amountRepaid: number;\n  purpose?: string;\n  status: LoanStatus;\n  dueDate?: string | null;\n  approvedAt?: string | null;\n  disbursedAt?: string | null;\n  repaidAt?: string | null;\n  createdAt: string;\n  updatedAt?: string;\n};\n\n/** Fetch the authenticated user's full profile. Requires a valid token. */\nexport async function getProfile(token: string): Promise<UserProfileResponse> {\n  const res = await fetch(endpoints.user.profile(), {\n    headers: getAuthHeaders(token),\n  });\n  const data = await res.json().catch(() => ({}));\n  handleAuthError(res);\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\" ? data.message : \"Failed to load profile\"\n    );\n  }\n  // Response shape: { message: string, user: UserProfileResponse }\n  const profile = (data as { user?: UserProfileResponse }).user ?? data;\n  return profile as UserProfileResponse;\n}\n\n/** Fetch a user's wallet balance by userId. */\nexport async function getWallet(\n  token: string,\n  userId: string\n): Promise<WalletResponse> {\n  const res = await fetch(endpoints.loans.wallet(userId), {\n    headers: getAuthHeaders(token),\n  });\n  const data = await res.json().catch(() => ({}));\n  handleAuthError(res);\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\" ? data.message : \"Failed to load wallet\"\n    );\n  }\n  return data as WalletResponse;\n}\n\n/** Fetch a user's loan history by userId. */\nexport async function listLoans(\n  token: string,\n  userId: string\n): Promise<LoanItem[]> {\n  const res = await fetch(endpoints.loans.list(userId), {\n    headers: getAuthHeaders(token),\n  });\n  const data = await res.json().catch(() => ({}));\n  handleAuthError(res);\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\" ? data.message : \"Failed to load loans\"\n    );\n  }\n  // Response shape from loan-service: { loans: LoanItem[] }\n  if (Array.isArray(data)) return data;\n  const nested = data as { loans?: LoanItem[]; data?: LoanItem[] };\n  return nested.loans ?? nested.data ?? [];\n}\n\nexport type RepaymentItem = {\n  id: string;\n  loanId: string;\n  userId: string;\n  amount: number;\n  repaidAt: string;\n};\n\nexport type LoanEligibility = {\n  canRequest: boolean;\n  maxAmount: number;\n  availableAmount: number;\n  totalOutstanding?: number;\n  reason?: string;\n  activeLoan?: {\n    id: string;\n    status: string;\n    amount: number;\n    amountRepaid: number;\n    remaining: number;\n  } | null;\n};\n\n/** Check if a user is eligible to request a loan and how much they can borrow. */\nexport async function getLoanEligibility(\n  token: string,\n  userId: string\n): Promise<LoanEligibility> {\n  const res = await fetch(endpoints.loans.eligibility(userId), {\n    headers: getAuthHeaders(token),\n  });\n  const data = await res.json().catch(() => ({}));\n  handleAuthError(res);\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\" ? data.message : \"Failed to check eligibility\"\n    );\n  }\n  return data as LoanEligibility;\n}\n\n/** Submit a loan request for the authenticated user. */\nexport async function requestLoan(\n  token: string,\n  payload: { userId: string; amount: number; purpose?: string }\n): Promise<{ message: string; loan: LoanItem }> {\n  const res = await fetch(endpoints.loans.request(), {\n    method: \"POST\",\n    headers: getAuthHeaders(token),\n    body: JSON.stringify(payload),\n  });\n  const data = await res.json().catch(() => ({}));\n  handleAuthError(res);\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\"\n        ? data.message\n        : Array.isArray(data.message)\n          ? data.message[0]\n          : \"Failed to submit loan request\"\n    );\n  }\n  return data as { message: string; loan: LoanItem };\n}\n\n// ─── Registration ──────────────────────────────────────────────────────────────\n\n/** Direct registration — creates user immediately without OTP. User starts unverified. */\nexport async function registerUser(\n  payload: {\n    email: string;\n    password: string;\n    firstName: string;\n    lastName: string;\n    nin: string;\n    picture?: string | null;\n    ninSlip?: string | null;\n  }\n): Promise<{ message: string; user: { id: string; email: string; firstName: string; lastName: string; userNumber?: string } }> {\n  const res = await fetch(endpoints.auth.register(), {\n    method: \"POST\",\n    headers: getAuthHeaders(),\n    body: JSON.stringify(payload),\n  });\n  const data = await res.json().catch(() => ({}));\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\"\n        ? data.message\n        : Array.isArray(data.message)\n          ? data.message[0]\n          : \"Registration failed\"\n    );\n  }\n  return data as { message: string; user: { id: string; email: string; firstName: string; lastName: string; userNumber?: string } };\n}\n\nexport type RegisterCodePayload = {\n  email: string;\n  password: string;\n  firstName: string;\n  lastName: string;\n  nin: string;\n  picture?: string | null;\n  ninSlip?: string | null;\n};\n\n/** Step 1 of register: store pending registration, send OTP to email. */\nexport async function requestRegisterCode(\n  payload: RegisterCodePayload\n): Promise<{ message: string }> {\n  const res = await fetch(endpoints.auth.requestCode(), {\n    method: \"POST\",\n    headers: getAuthHeaders(),\n    body: JSON.stringify({ type: \"register\", ...payload }),\n  });\n  const data = await res.json().catch(() => ({}));\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\"\n        ? data.message\n        : Array.isArray(data.message)\n          ? data.message[0]\n          : \"Failed to send verification code\"\n    );\n  }\n  return data as { message: string };\n}\n\n/** Step 2: verify OTP (type 'login' or 'register'). Returns JWT + user. */\nexport async function verifyCode(payload: {\n  type: \"login\" | \"register\";\n  email: string;\n  code: string;\n}): Promise<{\n  message: string;\n  token: string;\n  user?: {\n    id: string;\n    email: string;\n    role: string;\n    firstName?: string;\n    lastName?: string;\n    picture?: string | null;\n    verified?: boolean;\n  };\n}> {\n  const res = await fetch(endpoints.auth.verifyCode(), {\n    method: \"POST\",\n    headers: getAuthHeaders(),\n    body: JSON.stringify(payload),\n  });\n  const data = await res.json().catch(() => ({}));\n  handleAuthError(res);\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\"\n        ? data.message\n        : Array.isArray(data.message)\n          ? data.message[0]\n          : \"Invalid or expired code\"\n    );\n  }\n  return data as {\n    message: string;\n    token: string;\n    user?: { id: string; email: string; role: string; firstName?: string; lastName?: string; picture?: string | null; verified?: boolean };\n  };\n}\n\n/** Upload an image file to Cloudinary via the file-service. Returns the secure URL. */\nexport async function uploadImage(\n  file: File,\n  options?: { folder?: string; token?: string | null }\n): Promise<{ url: string; secureUrl: string; publicId?: string }> {\n  const formData = new FormData();\n  formData.append(\"file\", file);\n  if (options?.folder) formData.append(\"folder\", options.folder);\n  const headers: HeadersInit = {};\n  if (options?.token) {\n    (headers as Record<string, string>)[\"Authorization\"] = `Bearer ${options.token}`;\n  }\n  const res = await fetch(endpoints.files.upload(), {\n    method: \"POST\",\n    headers,\n    body: formData,\n  });\n  const data = await res.json().catch(() => ({}));\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\"\n        ? data.message\n        : (data as { error?: string }).error ?? \"Upload failed\"\n    );\n  }\n  return data as { url: string; secureUrl: string; publicId?: string };\n}\n\n/** Record a loan repayment. Called after a successful BudPay payment. */\nexport async function recordLoanRepayment(\n  token: string,\n  payload: { loanId: string; amount: number }\n): Promise<{ message: string; loan: LoanItem }> {\n  const res = await fetch(endpoints.loans.repay(), {\n    method: \"POST\",\n    headers: getAuthHeaders(token),\n    body: JSON.stringify(payload),\n  });\n  const data = await res.json().catch(() => ({}));\n  handleAuthError(res);\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\"\n        ? data.message\n        : Array.isArray(data.message)\n          ? data.message[0]\n          : \"Failed to record repayment\"\n    );\n  }\n  return data as { message: string; loan: LoanItem };\n}\n\n/** Fetch a user's repayment transactions by userId. */\nexport async function listUserRepayments(\n  token: string,\n  userId: string\n): Promise<RepaymentItem[]> {\n  const res = await fetch(endpoints.loans.repayments(userId), {\n    headers: getAuthHeaders(token),\n  });\n  const data = await res.json().catch(() => ({}));\n  handleAuthError(res);\n  if (!res.ok) {\n    throw new Error(\n      typeof data.message === \"string\"\n        ? data.message\n        : \"Failed to load repayments\"\n    );\n  }\n  // Response shape: { userId, repayments: [...] }\n  const raw = data as { repayments?: RepaymentItem[] } | RepaymentItem[];\n  return Array.isArray(raw) ? raw : (raw.repayments ?? []);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 326, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamabdullahi/Documents/Js_portfolio/stillPlay/microservices/my-workspace/apps/stillPlay-mobile/src/store/useAuthStore.ts"],"sourcesContent":["import { create } from \"zustand\";\nimport {\n  persist,\n  createJSONStorage,\n  type StateStorage,\n} from \"zustand/middleware\";\nimport { isTokenExpired } from \"../lib/api\";\n\nexport type AuthStatus = \"unauthenticated\" | \"otp_required\" | \"authenticated\";\n\nexport type UserProfile = {\n  id: string;\n  email: string;\n  role: string;\n  verified?: boolean;\n  firstName?: string;\n  lastName?: string;\n  picture?: string | null;\n  userNumber?: string;\n  createdAt?: string;\n};\n\ntype AuthState = {\n  status: AuthStatus;\n  token: string | null;\n  user: UserProfile | null;\n  otpEmail: string | null;\n  otpExpiresAt: number | null;\n  fullName: string | null;\n  _hasRehydrated: boolean;\n  lastLoginAt: number | null;\n\n  setPendingOtp: (email: string, otpExpiresAt: number, fullName?: string) => void;\n  setAuthenticated: (token: string, user: UserProfile | null) => void;\n  setUser: (user: UserProfile) => void;\n  setRehydrated: () => void;\n  reset: () => void;\n\n  /** @deprecated use setAuthenticated */\n  login: () => void;\n  /** @deprecated use reset */\n  logout: () => void;\n  isAuthenticated: boolean;\n};\n\nconst initialState = {\n  status: \"unauthenticated\" as AuthStatus,\n  token: null as string | null,\n  user: null as UserProfile | null,\n  otpEmail: null as string | null,\n  otpExpiresAt: null as number | null,\n  fullName: null as string | null,\n  _hasRehydrated: false,\n  lastLoginAt: null as number | null,\n  isAuthenticated: false,\n};\n\nconst useAuthStore = create<AuthState>()(\n  persist(\n    (set) => ({\n      ...initialState,\n\n      setPendingOtp: (email, otpExpiresAt, fullName) =>\n        set({\n          status: \"otp_required\",\n          otpEmail: email,\n          otpExpiresAt,\n          fullName: fullName ?? null,\n        }),\n\n      setAuthenticated: (token, user) =>\n        set({\n          status: \"authenticated\",\n          token,\n          user,\n          otpEmail: null,\n          otpExpiresAt: null,\n          lastLoginAt: Date.now(),\n          isAuthenticated: true,\n        }),\n\n      setUser: (user) => set({ user }),\n\n      setRehydrated: () => set({ _hasRehydrated: true }),\n\n      reset: () => set({ ...initialState, _hasRehydrated: true, isAuthenticated: false }),\n\n      login: () => set({ isAuthenticated: true, status: \"authenticated\" }),\n      logout: () => set({ ...initialState, _hasRehydrated: true }),\n    }),\n    {\n      name: \"stillplay-mobile-auth\",\n      storage: createJSONStorage(() => {\n        if (typeof window === \"undefined\") {\n          const noopStorage: StateStorage = {\n            getItem: () => null,\n            setItem: () => {},\n            removeItem: () => {},\n          };\n          return noopStorage;\n        }\n        return localStorage;\n      }),\n      partialize: (state) => ({\n        status: state.status,\n        token: state.token,\n        user: state.user,\n        fullName: state.fullName,\n        otpEmail: state.otpEmail,\n        otpExpiresAt: state.otpExpiresAt,\n        lastLoginAt: state.lastLoginAt,\n        isAuthenticated: state.isAuthenticated,\n      }),\n      onRehydrateStorage: () => () => {\n        const state = useAuthStore.getState();\n        // If the persisted token is expired, clear auth before marking as rehydrated\n        // so the dashboard guard always redirects to login with a clean state.\n        if (state.status === \"authenticated\" && isTokenExpired(state.token)) {\n          state.reset();\n        } else {\n          state.setRehydrated();\n        }\n      },\n    }\n  )\n);\n\nexport default useAuthStore;\n"],"names":[],"mappings":";;;;AAAA;AACA;AAKA;;;;AAuCA,MAAM,eAAe;IACnB,QAAQ;IACR,OAAO;IACP,MAAM;IACN,UAAU;IACV,cAAc;IACd,UAAU;IACV,gBAAgB;IAChB,aAAa;IACb,iBAAiB;AACnB;AAEA,MAAM,eAAe,IAAA,oLAAM,IACzB,IAAA,0LAAO,EACL,CAAC,MAAQ,CAAC;QACR,GAAG,YAAY;QAEf,eAAe,CAAC,OAAO,cAAc,WACnC,IAAI;gBACF,QAAQ;gBACR,UAAU;gBACV;gBACA,UAAU,YAAY;YACxB;QAEF,kBAAkB,CAAC,OAAO,OACxB,IAAI;gBACF,QAAQ;gBACR;gBACA;gBACA,UAAU;gBACV,cAAc;gBACd,aAAa,KAAK,GAAG;gBACrB,iBAAiB;YACnB;QAEF,SAAS,CAAC,OAAS,IAAI;gBAAE;YAAK;QAE9B,eAAe,IAAM,IAAI;gBAAE,gBAAgB;YAAK;QAEhD,OAAO,IAAM,IAAI;gBAAE,GAAG,YAAY;gBAAE,gBAAgB;gBAAM,iBAAiB;YAAM;QAEjF,OAAO,IAAM,IAAI;gBAAE,iBAAiB;gBAAM,QAAQ;YAAgB;QAClE,QAAQ,IAAM,IAAI;gBAAE,GAAG,YAAY;gBAAE,gBAAgB;YAAK;IAC5D,CAAC,GACD;IACE,MAAM;IACN,SAAS,IAAA,oMAAiB,EAAC;QACzB;;QAQA,OAAO;IACT;IACA,YAAY,CAAC,QAAU,CAAC;YACtB,QAAQ,MAAM,MAAM;YACpB,OAAO,MAAM,KAAK;YAClB,MAAM,MAAM,IAAI;YAChB,UAAU,MAAM,QAAQ;YACxB,UAAU,MAAM,QAAQ;YACxB,cAAc,MAAM,YAAY;YAChC,aAAa,MAAM,WAAW;YAC9B,iBAAiB,MAAM,eAAe;QACxC,CAAC;IACD,oBAAoB,IAAM;YACxB,MAAM,QAAQ,aAAa,QAAQ;YACnC,6EAA6E;YAC7E,uEAAuE;YACvE,IAAI,MAAM,MAAM,KAAK,mBAAmB,IAAA,qKAAc,EAAC,MAAM,KAAK,GAAG;gBACnE,MAAM,KAAK;YACb,OAAO;gBACL,MAAM,aAAa;YACrB;QACF;AACF;uCAIW"}},
    {"offset": {"line": 419, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamabdullahi/Documents/Js_portfolio/stillPlay/microservices/my-workspace/apps/stillPlay-mobile/src/app/dashboard/layout.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  BottomNavigation,\n  BottomNavigationAction,\n  Box,\n  Paper,\n} from \"@mui/material\";\nimport HomeIcon from \"@mui/icons-material/Home\";\nimport SportsSoccerIcon from \"@mui/icons-material/SportsSoccer\";\nimport SendIcon from \"@mui/icons-material/Send\";\nimport PersonIcon from \"@mui/icons-material/Person\";\nimport { usePathname, useRouter } from \"next/navigation\";\nimport { useEffect, useState, type ReactNode } from \"react\";\nimport { CircularProgress } from \"@mui/material\";\n\nimport MobileFrame from \"@/components/MobileFrame\";\nimport useAuthStore from \"@/store/useAuthStore\";\nimport { isTokenExpired } from \"@/lib/api\";\n\nconst navigationItems = [\n  { label: \"Home\", icon: <HomeIcon />, href: \"/dashboard\" },\n  { label: \"Explore\", icon: <SportsSoccerIcon />, href: \"/dashboard/explore\" },\n  { label: \"Repayment\", icon: <SendIcon />, href: \"/dashboard/repayment\" },\n  { label: \"Profile\", icon: <PersonIcon />, href: \"/dashboard/profile\" },\n];\n\nexport default function DashboardLayout({ children }: { children: ReactNode }) {\n  const router = useRouter();\n  const pathname = usePathname();\n\n  const status = useAuthStore((s) => s.status);\n  const token = useAuthStore((s) => s.token);\n  const user = useAuthStore((s) => s.user);\n  const reset = useAuthStore((s) => s.reset);\n\n  // Use a local mounted flag instead of Zustand's _hasRehydrated.\n  // This ensures server and client both render `false` on the first pass\n  // (no React hydration mismatch). By the time the useEffect fires,\n  // Zustand has already synced from localStorage (sync storage), so\n  // auth state is ready to evaluate.\n  const [isMounted, setIsMounted] = useState(false);\n  useEffect(() => {\n    setIsMounted(true);\n  }, []);\n\n  const tokenExpired = isTokenExpired(token);\n  const isInvalid =\n    status !== \"authenticated\" || !token || !user?.id || tokenExpired;\n  // Registered but not yet verified by an admin\n  const isPendingVerification = !isInvalid && user?.verified === false;\n\n  useEffect(() => {\n    if (!isMounted) return;\n    if (isInvalid) {\n      reset();\n      router.replace(\"/login\");\n    } else if (isPendingVerification) {\n      router.replace(\"/pending-verification\");\n    }\n  }, [isMounted, isInvalid, isPendingVerification, reset, router]);\n\n  if (!isMounted || isInvalid || isPendingVerification) {\n    return (\n      <MobileFrame>\n        <Box\n          className=\"screen-content\"\n          sx={{ display: \"flex\", alignItems: \"center\", justifyContent: \"center\" }}\n        >\n          <CircularProgress color=\"primary\" />\n        </Box>\n      </MobileFrame>\n    );\n  }\n\n  return (\n    <MobileFrame>\n      <Box className=\"screen-content\" sx={{ overflow: \"hidden\" }}>\n        <Box\n          sx={{\n            flex: 1,\n            height: \"100%\",\n            position: \"relative\",\n            overflow: \"hidden\",\n          }}\n        >\n          {children}\n        </Box>\n\n        <Paper\n          elevation={8}\n          sx={{\n            borderTopLeftRadius: 24,\n            borderTopRightRadius: 24,\n            position: \"relative\",\n            zIndex: 2,\n          }}\n        >\n          <BottomNavigation\n            showLabels={false}\n            value={pathname ?? \"/dashboard\"}\n            onChange={(_, newValue) => {\n              if (typeof newValue === \"string\" && newValue !== pathname) {\n                router.push(newValue);\n              }\n            }}\n            sx={{\n              height: 72,\n              \"& .MuiBottomNavigationAction-root\": {\n                minWidth: 0,\n                paddingY: 1.5,\n              },\n              \"& .MuiSvgIcon-root\": {\n                fontSize: 30,\n              },\n            }}\n          >\n            {navigationItems.map((item) => (\n              <BottomNavigationAction\n                key={item.href}\n                value={item.href}\n                icon={item.icon}\n                label={item.label}\n              />\n            ))}\n          </BottomNavigation>\n        </Paper>\n      </Box>\n    </MobileFrame>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}