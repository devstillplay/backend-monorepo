"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[675],{53675:function(t,e,a){function r(){return"https://api-gateway-production-dab1.up.railway.app/api"}function n(){if(!r())throw Error("API URL not configured. Set NEXT_PUBLIC_API_BASE_URL in .env.local or Railway (e.g. https://your-api.railway.app/api).")}a.d(e,{jY:function(){return X},$g:function(){return Q},xl:function(){return x},zN:function(){return tt},r8:function(){return ti},Qz:function(){return tl},Er:function(){return J},eJ:function(){return to},hO:function(){return tu},I2:function(){return H},Hd:function(){return z},WN:function(){return G},o3:function(){return K},hJ:function(){return B},Rt:function(){return M},p0:function(){return q},Cy:function(){return C},zO:function(){return tn},cA:function(){return D},Cb:function(){return W},vG:function(){return ts},xp:function(){return tc},BX:function(){return _},ey:function(){return U},ho:function(){return V},G7:function(){return R},f8:function(){return $},c0:function(){return ta},WD:function(){return tf},C_:function(){return Z},vr:function(){return T},Ix:function(){return te},VP:function(){return tr}});let o=()=>"".concat(r(),"/auth/request-code"),s=()=>"".concat(r(),"/auth/verify-code"),i=()=>"".concat(r(),"/auth/login"),c=()=>"".concat(r(),"/auth/forgot-password"),l=()=>"".concat(r(),"/auth/reset-password"),u=()=>"".concat(r(),"/admin/users"),f=t=>"".concat(r(),"/admin/users/").concat(t),d=()=>"".concat(r(),"/admin/employees"),g=()=>"".concat(r(),"/admin/activity"),h=t=>"".concat(r(),"/loans/eligibility/").concat(t),y=()=>"".concat(r(),"/admin/loans/request"),m=()=>"".concat(r(),"/admin/loans"),p=()=>"".concat(r(),"/admin/loans/all/repayments"),w=t=>"".concat(r(),"/admin/loans/user/").concat(t),A=t=>"".concat(r(),"/admin/loans/user/").concat(t,"/repayments"),E=t=>"".concat(r(),"/admin/loans/user/").concat(t,"/wallet"),S=()=>"".concat(r(),"/admin/loans/approve"),v=()=>"".concat(r(),"/admin/loans/reject"),k=()=>"".concat(r(),"/admin/settings"),j=()=>"".concat(r(),"/admin/settings"),O=()=>"".concat(r(),"/providers"),F=()=>"".concat(r(),"/providers"),P=()=>"".concat(r(),"/files/upload");var L=a(9099),N=a(88219);function b(t){let e={"Content-Type":"application/json"};return t&&(e.Authorization="Bearer ".concat(t)),e}function I(t){401===t.status&&(L.t.getState().reset(),N.LM.getState().reset())}async function T(t,e,a){let r=await fetch(f(e),{method:"PATCH",headers:b(t),body:JSON.stringify(a)}),n=await r.json().catch(()=>({}));if(!r.ok)throw I(r),Error("string"==typeof n.message?n.message:Array.isArray(n.message)?n.message[0]:"Failed to update user");return n}async function J(t,e){let a=await fetch(f(e),{method:"DELETE",headers:b(t)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Failed to delete user");return r}async function _(t,e){let a=await fetch(g(),{method:"POST",headers:b(t),body:JSON.stringify(e)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Failed to record activity");return r}async function C(t,e){let a=new URL(g());null!=e&&a.searchParams.set("limit",String(e));let r=await fetch(a.toString(),{headers:b(t)}),n=await r.json().catch(()=>({}));if(!r.ok)throw I(r),Error("string"==typeof n.message?n.message:"Failed to load activity");return n}async function R(t,e){let a=await fetch(y(),{method:"POST",headers:b(t),body:JSON.stringify(e)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Failed to request loan");return r}async function x(t,e){let a=await fetch(S(),{method:"POST",headers:b(t),body:JSON.stringify({loanId:e})}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:"Failed to approve loan");return r}async function U(t,e){let a=await fetch(v(),{method:"POST",headers:b(t),body:JSON.stringify({loanId:e})}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:"Failed to reject loan");return r}async function z(t,e){let a=await fetch(h(e),{headers:b(t)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:"Failed to load eligibility");return r}async function B(t,e){let a=await fetch(w(e),{headers:b(t)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:"Failed to load loans");return{loans:Array.isArray(r.loans)?r.loans:[]}}async function M(t,e){var a;let r=await fetch(A(e),{headers:b(t)}),n=await r.json().catch(()=>({}));if(!r.ok)throw I(r),Error("string"==typeof n.message?n.message:"Failed to load repayments");return{userId:null!==(a=n.userId)&&void 0!==a?a:e,repayments:Array.isArray(n.repayments)?n.repayments:[]}}async function q(t,e){let a=await fetch(E(e),{headers:b(t)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:"Failed to load wallet");return r}async function D(t){let e=await fetch(m(),{headers:b(t)}),a=await e.json().catch(()=>({}));if(!e.ok)throw I(e),Error("string"==typeof a.message?a.message:"Failed to load loans");return{loans:Array.isArray(a.loans)?a.loans:[]}}async function W(t){let e=await fetch(p(),{headers:b(t)}),a=await e.json().catch(()=>({}));if(!e.ok)throw I(e),Error("string"==typeof a.message?a.message:"Failed to load repayments");return{repayments:Array.isArray(a.repayments)?a.repayments:[]}}let X=["Super Admin","Finance","Customer Support","Operations","Legal & Compliance","Auditor"];function G(t){var e,a;let r=null!==(e=t.agreedAmount)&&void 0!==e?e:null;return null==r||r<=0?null:Math.round(r*(1+(null!==(a=t.providerCutPercentage)&&void 0!==a?a:0)/100)*100)/100}function H(t){var e,a,r;let n=null!==(e=t.agreedAmount)&&void 0!==e?e:null;if(null==n||n<=0)return null;let o=(null!==(a=t.percentageToAdd)&&void 0!==a?a:0)-(null!==(r=t.providerCutPercentage)&&void 0!==r?r:0);return o<=0?0:Math.round(o/100*n*100)/100}async function Q(t){let e=await fetch(i(),{method:"POST",headers:b(),body:JSON.stringify({email:t.email.trim(),password:t.password})}),a=await e.json().catch(()=>({}));if(!e.ok)throw Error("string"==typeof a.message?a.message:Array.isArray(a.message)?a.message[0]:"Invalid email or password");return a}async function V(t){let e=await fetch(o(),{method:"POST",headers:b(),body:JSON.stringify(t)}),a=await e.json().catch(()=>({}));if(!e.ok)throw Error("string"==typeof a.message?a.message:Array.isArray(a.message)?a.message[0]:"Failed to send code");return a}let Y="stillplay_reset_token";async function $(t){n();let e=await fetch(c(),{method:"POST",headers:b(),body:JSON.stringify({email:t.trim()})}),a=await e.json().catch(()=>({}));if(!e.ok)throw Error("string"==typeof a.message?a.message:Array.isArray(a.message)?a.message[0]:"Failed to send reset code");return a}function K(){return sessionStorage.getItem(Y)}function Z(t){sessionStorage.setItem(Y,t)}function tt(){sessionStorage.removeItem(Y)}async function te(t,e){n();let a=new FormData;a.append("file",t),(null==e?void 0:e.folder)&&a.append("folder",e.folder);let r={};(null==e?void 0:e.token)&&(r.Authorization="Bearer ".concat(e.token));let o=await fetch(P(),{method:"POST",headers:r,body:a}),s=await o.json().catch(()=>({}));if(!o.ok){var i;throw Error("string"==typeof s.message?s.message:null!==(i=s.error)&&void 0!==i?i:"Upload failed")}if(s&&"object"==typeof s&&"error"in s)throw Error(s.error);return s}async function ta(t){n();let e=await fetch(l(),{method:"POST",headers:b(),body:JSON.stringify(t)}),a=await e.json().catch(()=>({}));if(!e.ok)throw Error("string"==typeof a.message?a.message:Array.isArray(a.message)?a.message[0]:"Failed to reset password");return a}async function tr(t){n();let e=await fetch(s(),{method:"POST",headers:b(),body:JSON.stringify(t)}),a=await e.text(),r={};try{r=a?JSON.parse(a):{}}catch(t){if(a.trimStart().startsWith("<!"))throw Error("Received a web page instead of API. Set NEXT_PUBLIC_API_BASE_URL in .env.local to your API gateway (e.g. http://localhost:3000/api) and restart.");throw Error(a.slice(0,120)||"Invalid or expired code")}if(!e.ok)throw Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Invalid or expired code");return r}async function tn(t){var e;let a=await fetch(u(),{headers:b(t)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:"Failed to load users");return Array.isArray(r)?r:null!==(e=r.users)&&void 0!==e?e:[]}async function to(t,e){let a=await fetch(f(e),{headers:b(t)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:"Failed to load user");return r}async function ts(t){var e;let a=await fetch(d(),{headers:b(t)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:"Failed to load staff");return Array.isArray(r)?r:null!==(e=r.employees)&&void 0!==e?e:[]}async function ti(t,e){let a=await fetch(d(),{method:"POST",headers:b(t),body:JSON.stringify(e)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Failed to create staff");return r}async function tc(t){var e;let a=await fetch(O(),{headers:b(t)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:"Failed to load providers");return Array.isArray(r)?r:null!==(e=r.providers)&&void 0!==e?e:[]}async function tl(t,e){let a=await fetch(F(),{method:"POST",headers:b(t),body:JSON.stringify(e)}),r=await a.json().catch(()=>({}));if(!a.ok)throw I(a),Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Failed to create provider");return r}async function tu(t){let e=await fetch(k(),{headers:b(t)}),a=await e.json().catch(()=>({}));if(!e.ok)throw I(e),Error("string"==typeof a.message?a.message:"Failed to load settings");return a}async function tf(t,e,a){let r=await fetch(j(),{method:"POST",headers:b(t),body:JSON.stringify({key:e,value:a})}),n=await r.json().catch(()=>({}));if(!r.ok)throw I(r),Error("string"==typeof n.message?n.message:"Failed to save setting");return n}},9099:function(t,e,a){a.d(e,{t:function(){return i}});var r=a(59625),n=a(89134),o=a(88219);let s={status:"unauthenticated",token:null,user:null,otpEmail:null,otpExpiresAt:null,fullName:null,_hasRehydrated:!1,lastLoginAt:null,lastLoginIp:null,lastAction:null},i=(0,r.Ue)()((0,n.tJ)(t=>({...s,setPendingOtp:(e,a,r)=>t({status:"otp_required",otpEmail:e,otpExpiresAt:a,fullName:null!=r?r:null}),setAuthenticated:(e,a)=>t({status:"authenticated",token:e,user:a,otpEmail:null,otpExpiresAt:null,lastLoginAt:Date.now()}),setUser:e=>t({user:e}),setRehydrated:()=>t({_hasRehydrated:!0}),setLastAction:e=>t({lastAction:e}),setLastLoginIp:e=>t({lastLoginIp:e}),reset:()=>t(s)}),{name:"stillplay-admin-auth",storage:(0,n.FL)(()=>localStorage),partialize:t=>({status:t.status,token:t.token,user:t.user,fullName:t.fullName,otpEmail:t.otpEmail,otpExpiresAt:t.otpExpiresAt,lastLoginAt:t.lastLoginAt,lastLoginIp:t.lastLoginIp,lastAction:t.lastAction}),onRehydrateStorage:()=>()=>{let t=i.getState();t.setRehydrated(),t.user&&o.LM.getState().setProfile(t.user)}}))},88219:function(t,e,a){a.d(e,{LM:function(){return o}});var r=a(59625),n=a(89134);let o=(0,r.Ue)()((0,n.tJ)(t=>({profile:null,setProfile:e=>t({profile:e}),reset:()=>t({profile:null})}),{name:"stillplay-admin-user",storage:(0,n.FL)(()=>localStorage),partialize:t=>({profile:t.profile})}))}}]);