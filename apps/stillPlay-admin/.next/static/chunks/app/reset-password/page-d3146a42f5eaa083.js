(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[363],{896:function(e,t,r){Promise.resolve().then(r.bind(r,878))},878:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var n=r(7437),a=r(9539),o=r(4523),i=r(8984),s=r(5002),l=r(1899),u=r(7404),c=r(3996),d=r(9832),f=r(2279),h=r(4013),g=r(1770),p=r(7648),m=r(9376),y=r(2265),v=r(6596),x=r(2603),w=r(3675);function A(){var e;let t=(0,m.useRouter)(),r=null!==(e=(0,m.useSearchParams)().get("email"))&&void 0!==e?e:"",[A,b]=(0,y.useState)(null),[j,S]=(0,y.useState)(r),[E,k]=(0,y.useState)(""),[P,Z]=(0,y.useState)(""),[I,C]=(0,y.useState)(""),[O,L]=(0,y.useState)(!1);(0,y.useEffect)(()=>{b((0,w.o3)())},[]),(0,y.useEffect)(()=>{r&&S(r)},[r]);let N=(0,g.D)({mutationFn:()=>{let e=(0,w.o3)();return(0,w.c0)({resetToken:null!=e?e:void 0,email:e?void 0:j.trim(),code:E,newPassword:P})},onSuccess:()=>{(0,w.zN)(),t.replace("/?reset=success")}}),T=!!(0,w.o3)()||""!==j.trim(),R=4===E.length&&P.length>=6&&P===I&&T,F=(0,y.useCallback)(e=>{if(e.preventDefault(),P!==I){N.reset();return}!(P.length<6)&&4===E.length&&((0,w.o3)()||j.trim())&&N.mutate()},[j,E,P,I]),_=I.length>0&&P!==I,D=(0,y.useCallback)((e,t)=>(0,n.jsx)("input",{...e,style:{width:56,height:56,textAlign:"center",fontSize:20,fontWeight:600,border:"none",borderRadius:8,backgroundColor:"#f2f2f2",outline:"none"}}),[]);return(0,n.jsx)(x.Z,{children:(0,n.jsxs)(i.Z,{spacing:3,sx:{width:"100%",alignItems:"stretch"},children:[(0,n.jsx)(s.Z,{variant:"h4",sx:{color:"#4a4a4a",textAlign:"left"},children:"Reset password"}),(0,n.jsx)(s.Z,{variant:"body2",color:"text.secondary",children:A?"Enter the 4-digit code from your email and choose a new password.":"Enter your email, the code from your email, and a new password. Or request a new code from the forgot password page."}),(0,n.jsx)(l.Z,{component:"form",onSubmit:F,children:(0,n.jsxs)(i.Z,{spacing:2,children:[!A&&(0,n.jsxs)(i.Z,{spacing:1,children:[(0,n.jsx)(s.Z,{variant:"body2",sx:{fontWeight:600},children:"Email"}),(0,n.jsx)(u.Z,{placeholder:"you@example.com",value:j,onChange:e=>S(e.target.value),type:"email",fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f2f2f2",borderRadius:2,"& fieldset":{border:"none"}}}})]}),(0,n.jsxs)(i.Z,{spacing:1,children:[(0,n.jsx)(s.Z,{variant:"body2",sx:{fontWeight:600},children:"Code"}),(0,n.jsx)(v.Z,{value:E,onChange:k,numInputs:4,renderInput:D,inputType:"number",containerStyle:{gap:8,justifyContent:"flex-start"}})]}),(0,n.jsxs)(i.Z,{spacing:1,children:[(0,n.jsx)(s.Z,{variant:"body2",sx:{fontWeight:600},children:"New password"}),(0,n.jsx)(u.Z,{placeholder:"Min 6 characters",value:P,onChange:e=>Z(e.target.value),type:O?"text":"password",required:!0,fullWidth:!0,error:P.length>0&&P.length<6,helperText:P.length>0&&P.length<6?"At least 6 characters":void 0,InputProps:{endAdornment:(0,n.jsx)(c.Z,{position:"end",children:(0,n.jsx)(d.Z,{"aria-label":O?"Hide":"Show",onClick:()=>L(e=>!e),edge:"end",size:"small",children:O?(0,n.jsx)(a.Z,{}):(0,n.jsx)(o.Z,{})})})},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f2f2f2",borderRadius:2,"& fieldset":{border:"none"}}}})]}),(0,n.jsxs)(i.Z,{spacing:1,children:[(0,n.jsx)(s.Z,{variant:"body2",sx:{fontWeight:600},children:"Confirm password"}),(0,n.jsx)(u.Z,{placeholder:"Repeat new password",value:I,onChange:e=>C(e.target.value),type:O?"text":"password",required:!0,fullWidth:!0,error:_,helperText:_?"Passwords do not match":void 0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f2f2f2",borderRadius:2,"& fieldset":{border:"none"}}}})]}),N.isError?(0,n.jsx)(f.Z,{severity:"error",children:N.error.message}):null,(0,n.jsx)(h.Z,{type:"submit",variant:"contained",size:"large",disabled:N.isPending||!R,fullWidth:!0,sx:{backgroundColor:"#0b7b4c"},children:N.isPending?"Resetting...":"Reset password"})]})}),(0,n.jsx)(s.Z,{variant:"body2",sx:{textAlign:"center"},children:(0,n.jsx)(p.default,{href:"/",style:{color:"inherit"},children:"Back to login"})})]})})}function b(){return(0,n.jsx)(y.Suspense,{fallback:(0,n.jsx)(x.Z,{children:(0,n.jsx)(l.Z,{sx:{py:4,textAlign:"center"},children:(0,n.jsx)(s.Z,{color:"text.secondary",children:"Loading..."})})}),children:(0,n.jsx)(A,{})})}},2603:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(7437),a=r(1899),o=r(4236);function i(){return(0,n.jsx)(a.Z,{component:o.E.div,initial:{backgroundPosition:"0% 50%"},animate:{backgroundPosition:["0% 50%","100% 50%","0% 50%"]},transition:{duration:7,repeat:1/0,ease:"linear"},sx:{position:"relative",display:{xs:"none",md:"flex"},alignItems:"center",justifyContent:"center",backgroundImage:"linear-gradient(135deg, #f0b12a 0%, #0b7b4c 55%, #f0b12a 100%)",backgroundSize:"200% 200%"},children:(0,n.jsx)(a.Z,{component:o.E.img,src:"/assets/svg/STILL PLAYLOGOWH.svg",alt:"Still Play",initial:{opacity:0,y:12,scale:.98},animate:{opacity:1,y:0,scale:1},transition:{duration:.6,ease:"easeOut"},sx:{width:{xs:140,md:180},height:"auto"}})})}function s(e){let{children:t}=e;return(0,n.jsx)(a.Z,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:0},children:(0,n.jsxs)(a.Z,{sx:{width:"100%",minHeight:"100vh",background:"#fff",borderRadius:0,overflow:"hidden",display:"grid",gridTemplateColumns:{xs:"1fr",md:"40% 60%"}},children:[(0,n.jsx)(i,{}),(0,n.jsx)(a.Z,{sx:{padding:{xs:3,md:6},display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)(a.Z,{component:o.E.div,initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},sx:{width:"100%",maxWidth:680},children:t})})]})})}},3675:function(e,t,r){"use strict";function n(){return"http://localhost:3000/api".replace(/\/$/,"")}function a(){if(!n())throw Error("API URL not configured. Add NEXT_PUBLIC_API_BASE_URL to .env.local (e.g. http://localhost:3000/api) and restart the dev server.")}r.d(t,{jY:function(){return S},zN:function(){return O},r8:function(){return _},Qz:function(){return z},Er:function(){return A},WN:function(){return E},o3:function(){return I},Cy:function(){return j},zO:function(){return R},vG:function(){return F},xp:function(){return D},BX:function(){return b},ho:function(){return k},f8:function(){return Z},c0:function(){return N},C_:function(){return C},vr:function(){return w},Ix:function(){return L},VP:function(){return T}});let o=()=>"".concat(n(),"/auth/request-code"),i=()=>"".concat(n(),"/auth/verify-code"),s=()=>"".concat(n(),"/auth/forgot-password"),l=()=>"".concat(n(),"/auth/reset-password"),u=()=>"".concat(n(),"/admin/users"),c=e=>"".concat(n(),"/admin/users/").concat(e),d=()=>"".concat(n(),"/admin/employees"),f=()=>"".concat(n(),"/admin/activity"),h=()=>"".concat(n(),"/providers"),g=()=>"".concat(n(),"/providers"),p=()=>"".concat(n(),"/files/upload");var m=r(9099),y=r(8219);function v(e){let t={"Content-Type":"application/json"};return e&&(t.Authorization="Bearer ".concat(e)),t}function x(e){401===e.status&&(m.t.getState().reset(),y.LM.getState().reset())}async function w(e,t,r){let n=await fetch(c(t),{method:"PATCH",headers:v(e),body:JSON.stringify(r)}),a=await n.json().catch(()=>({}));if(!n.ok)throw x(n),Error("string"==typeof a.message?a.message:Array.isArray(a.message)?a.message[0]:"Failed to update user");return a}async function A(e,t){let r=await fetch(c(t),{method:"DELETE",headers:v(e)}),n=await r.json().catch(()=>({}));if(!r.ok)throw x(r),Error("string"==typeof n.message?n.message:Array.isArray(n.message)?n.message[0]:"Failed to delete user");return n}async function b(e,t){let r=await fetch(f(),{method:"POST",headers:v(e),body:JSON.stringify(t)}),n=await r.json().catch(()=>({}));if(!r.ok)throw x(r),Error("string"==typeof n.message?n.message:Array.isArray(n.message)?n.message[0]:"Failed to record activity");return n}async function j(e,t){let r=new URL(f());null!=t&&r.searchParams.set("limit",String(t));let n=await fetch(r.toString(),{headers:v(e)}),a=await n.json().catch(()=>({}));if(!n.ok)throw x(n),Error("string"==typeof a.message?a.message:"Failed to load activity");return a}let S=["Super Admin","Finance","Customer Support","Operations","Legal & Compliance","Auditor"];function E(e){var t,r;let n=null!==(t=e.agreedAmount)&&void 0!==t?t:null;return null==n||n<=0?null:Math.round(n*(1+(null!==(r=e.percentageToAdd)&&void 0!==r?r:0)/100)*100)/100}async function k(e){let t=await fetch(o(),{method:"POST",headers:v(),body:JSON.stringify(e)}),r=await t.json().catch(()=>({}));if(!t.ok)throw Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Failed to send code");return r}let P="stillplay_reset_token";async function Z(e){a();let t=await fetch(s(),{method:"POST",headers:v(),body:JSON.stringify({email:e.trim()})}),r=await t.json().catch(()=>({}));if(!t.ok)throw Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Failed to send reset code");return r}function I(){return sessionStorage.getItem(P)}function C(e){sessionStorage.setItem(P,e)}function O(){sessionStorage.removeItem(P)}async function L(e,t){a();let r=new FormData;r.append("file",e),(null==t?void 0:t.folder)&&r.append("folder",t.folder);let n={};(null==t?void 0:t.token)&&(n.Authorization="Bearer ".concat(t.token));let o=await fetch(p(),{method:"POST",headers:n,body:r}),i=await o.json().catch(()=>({}));if(!o.ok){var s;throw Error("string"==typeof i.message?i.message:null!==(s=i.error)&&void 0!==s?s:"Upload failed")}if(i&&"object"==typeof i&&"error"in i)throw Error(i.error);return i}async function N(e){a();let t=await fetch(l(),{method:"POST",headers:v(),body:JSON.stringify(e)}),r=await t.json().catch(()=>({}));if(!t.ok)throw Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Failed to reset password");return r}async function T(e){a();let t=await fetch(i(),{method:"POST",headers:v(),body:JSON.stringify(e)}),r=await t.text(),n={};try{n=r?JSON.parse(r):{}}catch(e){if(r.trimStart().startsWith("<!"))throw Error("Received a web page instead of API. Set NEXT_PUBLIC_API_BASE_URL in .env.local to your API gateway (e.g. http://localhost:3000/api) and restart.");throw Error(r.slice(0,120)||"Invalid or expired code")}if(!t.ok)throw Error("string"==typeof n.message?n.message:Array.isArray(n.message)?n.message[0]:"Invalid or expired code");return n}async function R(e){var t;let r=await fetch(u(),{headers:v(e)}),n=await r.json().catch(()=>({}));if(!r.ok)throw x(r),Error("string"==typeof n.message?n.message:"Failed to load users");return Array.isArray(n)?n:null!==(t=n.users)&&void 0!==t?t:[]}async function F(e){var t;let r=await fetch(d(),{headers:v(e)}),n=await r.json().catch(()=>({}));if(!r.ok)throw x(r),Error("string"==typeof n.message?n.message:"Failed to load staff");return Array.isArray(n)?n:null!==(t=n.employees)&&void 0!==t?t:[]}async function _(e,t){let r=await fetch(d(),{method:"POST",headers:v(e),body:JSON.stringify(t)}),n=await r.json().catch(()=>({}));if(!r.ok)throw x(r),Error("string"==typeof n.message?n.message:Array.isArray(n.message)?n.message[0]:"Failed to create staff");return n}async function D(e){var t;let r=await fetch(h(),{headers:v(e)}),n=await r.json().catch(()=>({}));if(!r.ok)throw x(r),Error("string"==typeof n.message?n.message:"Failed to load providers");return Array.isArray(n)?n:null!==(t=n.providers)&&void 0!==t?t:[]}async function z(e,t){let r=await fetch(g(),{method:"POST",headers:v(e),body:JSON.stringify(t)}),n=await r.json().catch(()=>({}));if(!r.ok)throw x(r),Error("string"==typeof n.message?n.message:Array.isArray(n.message)?n.message[0]:"Failed to create provider");return n}},6596:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(2265),a=function(e){return"object"==typeof e&&null!==e},o=function(e){var t=e.value,r=void 0===t?"":t,o=e.numInputs,i=void 0===o?4:o,s=e.onChange,l=e.onPaste,u=e.renderInput,c=e.shouldAutoFocus,d=void 0!==c&&c,f=e.inputType,h=void 0===f?"text":f,g=e.renderSeparator,p=e.placeholder,m=e.containerStyle,y=e.inputStyle,v=e.skipDefaultStyles,x=void 0!==v&&v,w=n.useState(0),A=w[0],b=w[1],j=n.useRef([]),S=function(){return r?r.toString().split(""):[]},E="number"===h||"tel"===h;n.useEffect(function(){j.current=j.current.slice(0,i)},[i]),n.useEffect(function(){var e;d&&(null===(e=j.current[0])||void 0===e||e.focus())},[d]);var k=function(){if("string"==typeof p){if(p.length===i)return p;p.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}},P=function(e){return(E?!isNaN(Number(e)):"string"==typeof e)&&1===e.trim().length},Z=function(e){var t=e.target.value;P(t)&&(N(t),L(A+1))},I=function(e){var t=e.nativeEvent,r=e.target.value;P(r)||(r.length!==i||r.split("").some(function(e){return!P(e)})||(T(r.split("")),L(i-1)),null===t.data&&"deleteContentBackward"===t.inputType&&(e.preventDefault(),N(""),L(A-1)),e.target.value="")},C=function(){b(A-1)},O=function(e){var t=S();[e.code,e.key].includes("Backspace")?(e.preventDefault(),N(""),L(A-1)):"Delete"===e.code?(e.preventDefault(),N("")):"ArrowLeft"===e.code?(e.preventDefault(),L(A-1)):"ArrowRight"===e.code?(e.preventDefault(),L(A+1)):e.key===t[A]?(e.preventDefault(),L(A+1)):("Spacebar"===e.code||"Space"===e.code||"ArrowUp"===e.code||"ArrowDown"===e.code)&&e.preventDefault()},L=function(e){var t,r,n=Math.max(Math.min(i-1,e),0);j.current[n]&&(null===(t=j.current[n])||void 0===t||t.focus(),null===(r=j.current[n])||void 0===r||r.select(),b(n))},N=function(e){var t=S();t[A]=e[0],T(t)},T=function(e){s(e.join(""))},R=function(e){e.preventDefault();var t,r=S(),n=A,a=e.clipboardData.getData("text/plain").slice(0,i-A).split("");if(!(E&&a.some(function(e){return isNaN(Number(e))}))){for(var o=0;o<i;++o)o>=A&&a.length>0&&(r[o]=null!==(t=a.shift())&&void 0!==t?t:"",n++);L(n),T(r)}};return n.createElement("div",{style:Object.assign({display:"flex",alignItems:"center"},a(m)&&m),className:"string"==typeof m?m:void 0,onPaste:l},Array.from({length:i},function(e,t){return t}).map(function(e){var t,r,o;return n.createElement(n.Fragment,{key:e},u({value:null!==(t=S()[e])&&void 0!==t?t:"",placeholder:null!==(o=null===(r=k())||void 0===r?void 0:r[e])&&void 0!==o?o:void 0,ref:function(t){return j.current[e]=t},onChange:Z,onFocus:function(t){b(e),t.target.select()},onBlur:C,onKeyDown:O,onPaste:R,autoComplete:"off","aria-label":"Please enter OTP character ".concat(e+1),style:Object.assign(x?{}:{width:"1em",textAlign:"center"},a(y)?y:{}),className:"string"==typeof y?y:void 0,type:h,inputMode:E?"numeric":"text",onInput:I},e),e<i-1&&("function"==typeof g?g(e):g))}))}},9099:function(e,t,r){"use strict";r.d(t,{t:function(){return s}});var n=r(9625),a=r(6885),o=r(8219);let i={status:"unauthenticated",token:null,user:null,otpEmail:null,otpExpiresAt:null,fullName:null,_hasRehydrated:!1,lastLoginAt:null,lastLoginIp:null,lastAction:null},s=(0,n.Ue)()((0,a.tJ)(e=>({...i,setPendingOtp:(t,r,n)=>e({status:"otp_required",otpEmail:t,otpExpiresAt:r,fullName:null!=n?n:null}),setAuthenticated:(t,r)=>e({status:"authenticated",token:t,user:r,otpEmail:null,otpExpiresAt:null,lastLoginAt:Date.now()}),setUser:t=>e({user:t}),setRehydrated:()=>e({_hasRehydrated:!0}),setLastAction:t=>e({lastAction:t}),setLastLoginIp:t=>e({lastLoginIp:t}),reset:()=>e(i)}),{name:"stillplay-admin-auth",storage:(0,a.FL)(()=>localStorage),partialize:e=>({status:e.status,token:e.token,user:e.user,fullName:e.fullName,otpEmail:e.otpEmail,otpExpiresAt:e.otpExpiresAt,lastLoginAt:e.lastLoginAt,lastLoginIp:e.lastLoginIp,lastAction:e.lastAction}),onRehydrateStorage:()=>()=>{let e=s.getState();e.setRehydrated(),e.user&&o.LM.getState().setProfile(e.user)}}))},8219:function(e,t,r){"use strict";r.d(t,{LM:function(){return o}});var n=r(9625),a=r(6885);let o=(0,n.Ue)()((0,a.tJ)(e=>({profile:null,setProfile:t=>e({profile:t}),reset:()=>e({profile:null})}),{name:"stillplay-admin-user",storage:(0,a.FL)(()=>localStorage),partialize:e=>({profile:e.profile})}))}},function(e){e.O(0,[165,43,498,262,404,49,135,448,494,971,117,744],function(){return e(e.s=896)}),_N_E=e.O()}]);