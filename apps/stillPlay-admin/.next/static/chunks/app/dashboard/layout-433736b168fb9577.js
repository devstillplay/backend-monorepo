(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{86293:function(e,t,n){Promise.resolve().then(n.bind(n,93301))},93301:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return D}});var r=n(57437),i=n(1899),a=n(8984),l=n(5002),s=n(59832),o=n(92253),u=n(99465),d=n(2265),c=n(99376),f=n(17375),y=n(45817),h=n(89714),p=n(20026),v=n(7784),x=n(24322),m=n(71304),b=n(67315),g=n(10642),j=n(67116),q=n(35389),k=n(8350),Z=n(94013),S=n(75293),K=n(8444),C=n(44236),L=n(27648),F=n(53675),w=n(58094),P=n(9099),R=n(88219);let N=[{label:"Overview",href:"/dashboard",icon:(0,r.jsx)(y.Z,{})},{label:"Users",href:"/dashboard?tab=users",icon:(0,r.jsx)(x.Z,{})},{label:"Providers",href:"/dashboard/providers",icon:(0,r.jsx)(f.Z,{})},{label:"Staff",href:"/dashboard/staff",icon:(0,r.jsx)(h.Z,{})},{label:"Loan Request",href:"/dashboard/loan-request",icon:(0,r.jsx)(m.Z,{})},{label:"Loan Repayment",href:"/dashboard/loan-repayment",icon:(0,r.jsx)(v.Z,{})},{label:"Support",href:"/dashboard/support",icon:(0,r.jsx)(g.Z,{})},{label:"Settings",href:"/dashboard/settings",icon:(0,r.jsx)(b.Z,{})}];function Q(e){var t,n,s,o,u,f,y,h,v,x,m,b,g;let{onNavigate:Q}=e,T=(0,c.usePathname)(),D=(0,c.useRouter)(),O=(0,c.useSearchParams)().get("tab"),E=(0,d.useRef)(null),[I,W]=(0,d.useState)(!1),[U,A]=(0,d.useState)(!1),[V,z]=(0,d.useState)(!1),[_,H]=(0,d.useState)(""),X=(0,P.t)(e=>e.reset),B=(0,P.t)(e=>e.token),Y=(0,P.t)(e=>e.fullName),G=(0,P.t)(e=>e.user),M=(0,P.t)(e=>e.setUser),J=(0,R.LM)(e=>e.profile),$=(0,R.LM)(e=>e.setProfile),ee=(0,R.LM)(e=>e.reset),et=(0,w.hV)(),{data:en}=(0,w.Xl)(),er=null!==(n=null==en?void 0:null===(t=en.loans)||void 0===t?void 0:t.filter(e=>"PENDING"===e.status).length)&&void 0!==n?n:0,ei=(null==J?void 0:J.firstName)&&(null==J?void 0:J.lastName)?"".concat(J.firstName," ").concat(J.lastName).trim():null!==(u=null!==(o=null!==(s=null==J?void 0:J.firstName)&&void 0!==s?s:null==J?void 0:J.email)&&void 0!==o?o:Y)&&void 0!==u?u:"Admin",ea=(null!==(f=null==J?void 0:J.role)&&void 0!==f?f:null==G?void 0:G.role)?String(null!==(y=null==J?void 0:J.role)&&void 0!==y?y:null==G?void 0:G.role).trim():"Admin",el=null!==(v=null!==(h=null==J?void 0:J.email)&&void 0!==h?h:null==G?void 0:G.email)&&void 0!==v?v:"",es=null!==(m=null!==(x=null==J?void 0:J.picture)&&void 0!==x?x:null==G?void 0:G.picture)&&void 0!==m?m:null,eo=null!==(b=null==J?void 0:J.id)&&void 0!==b?b:null==G?void 0:G.id,eu=async e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n){if(!eo||!B){H("Cannot update photo: session or user id missing. Try logging in again."),z(!0),e.target.value="";return}W(!0);try{let e=await (0,F.Ix)(n,{folder:"stillplay/avatars",token:B});et.mutate({id:eo,payload:{picture:e.secureUrl}},{onSuccess:()=>{let t=e.secureUrl;J&&$({...J,picture:t}),G&&M({...G,picture:t}),A(!0)},onSettled:()=>W(!1)})}catch(e){console.error(e),W(!1),H(e instanceof Error?e.message:"Upload failed"),z(!0)}finally{e.target.value=""}}};return(0,r.jsxs)(a.Z,{component:C.E.aside,initial:{opacity:0,x:-16},animate:{opacity:1,x:0},transition:{duration:.45,ease:"easeOut"},sx:{padding:{xs:2,md:3},height:"100%",minHeight:"100vh",justifyContent:"space-between"},children:[(0,r.jsxs)(a.Z,{spacing:3,children:[(0,r.jsx)(i.Z,{component:"img",src:"/assets/svg/STILL PLAYLOGOBL.svg",alt:"Still Play",sx:{width:140,height:"auto",marginX:"auto"}}),(0,r.jsxs)(i.Z,{sx:{textAlign:"center"},children:[(0,r.jsx)("input",{id:"sidebar-avatar-upload",ref:E,type:"file",accept:"image/*",style:{display:"none"},"aria-label":"Upload profile photo",disabled:I||et.isPending,onChange:eu}),(0,r.jsxs)(i.Z,{component:"label",htmlFor:"sidebar-avatar-upload",sx:{position:"relative",display:"inline-block",margin:"0 auto 8px",cursor:eo?"pointer":"default"},children:[(0,r.jsx)(j.Z,{src:null!=es?es:void 0,sx:{width:76,height:76,border:"2px solid #0b7b4c",opacity:I||et.isPending?.7:1},children:(null!==(g=null==ei?void 0:ei[0])&&void 0!==g?g:"?").toUpperCase()}),(I||et.isPending)&&(0,r.jsx)(i.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",bgcolor:"rgba(0,0,0,0.4)",pointerEvents:"none"},children:(0,r.jsx)(q.Z,{size:32,sx:{color:"white"}})})]}),(0,r.jsx)(l.Z,{variant:"subtitle2",children:ei.toUpperCase()}),el?(0,r.jsx)(l.Z,{variant:"caption",color:"text.secondary",display:"block",children:el}):null,(0,r.jsx)(l.Z,{variant:"caption",color:"primary",children:ea.toUpperCase()})]}),(0,r.jsx)(k.Z,{sx:{opacity:.5}}),(0,r.jsx)(a.Z,{spacing:1,children:N.map(e=>{let t="/dashboard"===e.href&&!e.href.includes("?"),n=e.href.includes("tab=users"),i=t?"/dashboard"===T&&"users"!==O:n?"/dashboard"===T&&"users"===O:T===e.href.split("?")[0],a="/dashboard/loan-request"===e.href&&er>0;return(0,r.jsx)(L.default,{href:e.href,style:{textDecoration:"none"},children:(0,r.jsx)(Z.Z,{fullWidth:!0,variant:"text",startIcon:a?(0,r.jsx)(S.Z,{badgeContent:er,color:"error",sx:{"& .MuiBadge-badge":{fontSize:11,fontWeight:700,minWidth:18,height:18}},children:e.icon}):e.icon,onClick:Q,sx:{justifyContent:"flex-start",color:i?"#f59e0b":"text.primary",backgroundColor:i?"#f3f3f3":"transparent",borderRadius:999,paddingY:1,paddingX:2},children:e.label})},e.href)})}),(0,r.jsx)(L.default,{href:"/dashboard/staff",style:{textDecoration:"none"},children:(0,r.jsx)(Z.Z,{variant:"contained",size:"small",fullWidth:!0,onClick:Q,children:"Create Admin Account"})})]}),(0,r.jsxs)(a.Z,{spacing:2,children:[(0,r.jsx)(k.Z,{sx:{opacity:.5}}),(0,r.jsx)(Z.Z,{variant:"text",color:"error",startIcon:(0,r.jsx)(p.Z,{}),onClick:()=>{X(),ee(),D.push("/")},sx:{justifyContent:"flex-start"},children:"Log out"})]}),(0,r.jsx)(K.Z,{open:U,autoHideDuration:4e3,onClose:()=>A(!1),message:"Profile photo updated successfully",anchorOrigin:{vertical:"bottom",horizontal:"center"},ContentProps:{sx:{bgcolor:"success.main",color:"success.contrastText"}}}),(0,r.jsx)(K.Z,{open:V,autoHideDuration:6e3,onClose:()=>z(!1),message:_,anchorOrigin:{vertical:"bottom",horizontal:"center"},ContentProps:{sx:{bgcolor:"error.main",color:"error.contrastText"}}})]})}let T={"/dashboard":"Viewed Dashboard","/dashboard/providers":"Viewed Providers","/dashboard/staff":"Viewed Staff","/dashboard/loan-request":"Viewed Loan Request","/dashboard/loan-repayment":"Viewed Loan Repayment","/dashboard/support":"Viewed Support","/dashboard/settings":"Viewed Settings"};function D(e){let{children:t}=e,n=(0,c.useRouter)(),f=(0,c.usePathname)(),y=(0,P.t)(e=>e.status),h=(0,P.t)(e=>e.token),p=(0,P.t)(e=>e.setLastAction),v=(0,P.t)(e=>e.lastLoginIp),x=(0,P.t)(e=>e._hasRehydrated),[m,b]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{let e=T[null!=f?f:""];e&&(p(e),(0,w.bA)({action:e,ip:null!=v?v:void 0}))},[f,p,v]),(0,d.useEffect)(()=>{x&&("authenticated"!==y||!h)&&n.replace("/")},[n,y,h,x]),(0,d.useEffect)(()=>{let e=setTimeout(()=>{P.t.getState()._hasRehydrated||P.t.getState().setRehydrated()},150);return()=>clearTimeout(e)},[]),(0,r.jsxs)(i.Z,{sx:{minHeight:"100vh",backgroundColor:"#fff",display:{xs:"flex",md:"grid"},flexDirection:{xs:"column",md:"unset"},gridTemplateColumns:{md:"260px 1fr"}},children:[(0,r.jsx)(i.Z,{sx:{display:{xs:"none",md:"block"}},children:(0,r.jsx)(d.Suspense,{fallback:null,children:(0,r.jsx)(Q,{})})}),(0,r.jsxs)(a.Z,{sx:{flex:1},children:[(0,r.jsxs)(a.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{display:{xs:"flex",md:"none"},paddingX:2,paddingY:1.5,borderBottom:"1px solid #edf2ef"},children:[(0,r.jsx)(l.Z,{variant:"h6",fontWeight:700,children:"Dashboard"}),(0,r.jsx)(s.Z,{onClick:()=>b(!0),children:(0,r.jsx)(u.Z,{})})]}),(0,r.jsx)(i.Z,{sx:{padding:{xs:2,md:3},flex:1},children:t})]}),(0,r.jsx)(o.ZP,{open:m,onClose:()=>b(!1),sx:{display:{xs:"block",md:"none"}},PaperProps:{sx:{width:260}},children:(0,r.jsx)(d.Suspense,{fallback:null,children:(0,r.jsx)(Q,{onNavigate:()=>b(!1)})})})]})}},58094:function(e,t,n){"use strict";n.d(t,{Cx:function(){return b},HI:function(){return q},Hv:function(){return F},It:function(){return j},OL:function(){return m},P7:function(){return k},RB:function(){return K},Rm:function(){return d},XO:function(){return c},Xl:function(){return S},Y7:function(){return p},Yn:function(){return w},bA:function(){return h},cy:function(){return C},ez:function(){return x},hV:function(){return f},ko:function(){return v},l2:function(){return g},pv:function(){return Z},ur:function(){return L},yf:function(){return y}});var r=n(11713),i=n(29827),a=n(21770),l=n(9099),s=n(53675);let o={all:["admin"],users:()=>[...o.all,"users"],user:e=>[...o.users(),e],employees:()=>[...o.all,"employees"],activity:()=>[...o.all,"activity"],settings:()=>[...o.all,"settings"],loans:{all:()=>[...o.all,"loans","all"],allRepayments:()=>[...o.all,"loans","repayments","all"],userLoans:e=>[...o.all,"loans","user",e],userRepayments:e=>[...o.all,"loans","repayments","user",e],userWallet:e=>[...o.all,"loans","wallet",e],userEligibility:e=>[...o.all,"loans","eligibility",e]}},u={all:["providers"],list:()=>[...u.all,"list"]};function d(){let e=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:o.users(),queryFn:()=>(0,s.zO)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:6e4})}function c(e){let t=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:[...o.users(),"detail",e],queryFn:()=>(0,s.eJ)(t,e),enabled:!!t&&!!e,staleTime:3e4})}function f(){let e=(0,l.t)(e=>e.token),t=(0,i.NL)();return(0,a.D)({mutationFn:t=>{let{id:n,payload:r}=t;return(0,s.vr)(e,n,r)},onSuccess:()=>{t.invalidateQueries({queryKey:o.users()}),h({action:"User edited"}),t.invalidateQueries({queryKey:o.activity()})}})}function y(e){let t=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:[...o.activity(),null!=e?e:50],queryFn:()=>(0,s.Cy)(t,e),enabled:!!t,staleTime:3e4})}function h(e){let t=l.t.getState().token;t&&(0,s.BX)(t,e).catch(()=>{})}function p(){let e=(0,l.t)(e=>e.token),t=(0,i.NL)();return(0,a.D)({mutationFn:t=>(0,s.Er)(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:o.users()}),h({action:"User deleted"}),t.invalidateQueries({queryKey:o.activity()})}})}function v(){let e=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:u.list(),queryFn:()=>(0,s.xp)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:6e4})}function x(){let e=(0,l.t)(e=>e.token),t=(0,i.NL)();return(0,a.D)({mutationFn:t=>(0,s.Qz)(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:u.list()}),h({action:"Provider added"}),t.invalidateQueries({queryKey:o.activity()})}})}function m(){let e=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:o.employees(),queryFn:()=>(0,s.vG)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:6e4})}function b(){let e=(0,l.t)(e=>e.token),t=(0,i.NL)();return(0,a.D)({mutationFn:t=>(0,s.r8)(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:o.employees()}),h({action:"Staff/employee created"}),t.invalidateQueries({queryKey:o.activity()})}})}function g(e){let t=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:o.loans.userLoans(null!=e?e:""),queryFn:()=>(0,s.hJ)(t,e),enabled:!!t&&!!e,staleTime:3e4})}function j(e){let t=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:o.loans.userRepayments(null!=e?e:""),queryFn:()=>(0,s.Rt)(t,e),enabled:!!t&&!!e,staleTime:3e4})}function q(e){let t=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:o.loans.userWallet(null!=e?e:""),queryFn:()=>(0,s.p0)(t,e),enabled:!!t&&!!e,staleTime:3e4})}function k(e){let t=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:o.loans.userEligibility(null!=e?e:""),queryFn:()=>(0,s.Hd)(t,e),enabled:!!t&&!!e,staleTime:15e3})}function Z(){let e=(0,l.t)(e=>e.token),t=(0,i.NL)();return(0,a.D)({mutationFn:t=>(0,s.G7)(e,t),onSuccess:(e,n)=>{t.invalidateQueries({queryKey:o.loans.userLoans(n.userId)}),t.invalidateQueries({queryKey:o.loans.userWallet(n.userId)}),t.invalidateQueries({queryKey:o.loans.userRepayments(n.userId)}),t.invalidateQueries({queryKey:o.loans.userEligibility(n.userId)}),t.invalidateQueries({queryKey:o.loans.all()}),t.invalidateQueries({queryKey:o.loans.allRepayments()})}})}function S(){let e=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:o.loans.all(),queryFn:()=>(0,s.cA)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:3e4})}function K(){let e=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:o.loans.allRepayments(),queryFn:()=>(0,s.Cb)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:3e4})}function C(){let e=(0,l.t)(e=>e.token),t=(0,i.NL)();return(0,a.D)({mutationFn:t=>(0,s.xl)(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:o.loans.all()}),h({action:"Loan approved"}),t.invalidateQueries({queryKey:o.activity()})}})}function L(){let e=(0,l.t)(e=>e.token),t=(0,i.NL)();return(0,a.D)({mutationFn:t=>(0,s.ey)(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:o.loans.all()}),h({action:"Loan rejected"}),t.invalidateQueries({queryKey:o.activity()})}})}function F(){let e=(0,l.t)(e=>e.token);return(0,r.a)({queryKey:o.settings(),queryFn:()=>(0,s.hO)(e),enabled:!!e,staleTime:6e4})}function w(){let e=(0,l.t)(e=>e.token),t=(0,i.NL)();return(0,a.D)({mutationFn:t=>{let{key:n,value:r}=t;return(0,s.WD)(e,n,r)},onSuccess:()=>{t.invalidateQueries({queryKey:o.settings()})}})}}},function(e){e.O(0,[515,330,262,666,140,236,713,448,746,506,675,971,117,744],function(){return e(e.s=86293)}),_N_E=e.O()}]);