(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2198:function(e,n,i){Promise.resolve().then(i.bind(i,496))},496:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return L}});var s=i(7437),t=i(1705),r=i(5784),a=i(9993),l=i(1899),o=i(8984),d=i(5002),c=i(9832),u=i(9962),x=i(8450),m=i(5389),h=i(4013),p=i(7116),f=i(6476),g=i(2253),j=i(7404),v=i(3392),Z=i(9507),b=i(7468),C=i(9026),y=i(2265),S=i(9376),k=i(4236),w=i(8243),P=i(3279),z=i(4061),N=i(7801),I=i(735),M=i(1052);function R(e){let{isVisible:n,suspended:i,onChatClick:t,onEditClick:r,onDeleteClick:a,onSuspendClick:l}=e;return(0,s.jsxs)(o.Z,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",sx:{opacity:n?1:0,pointerEvents:n?"auto":"none",transition:"opacity 0.2s ease"},children:[(0,s.jsx)(c.Z,{size:"small",onClick:t,"aria-label":"Open chat",children:(0,s.jsx)(z.Z,{fontSize:"small"})}),(0,s.jsx)(c.Z,{size:"small",onClick:r,"aria-label":"Edit user",children:(0,s.jsx)(I.Z,{fontSize:"small"})}),l&&(0,s.jsx)(h.Z,{size:"small",variant:"outlined",color:i?"success":"warning",startIcon:i?(0,s.jsx)(M.Z,{}):(0,s.jsx)(P.Z,{}),onClick:l,sx:{minWidth:0,px:1},children:i?"Unsuspend":"Suspend"}),(0,s.jsx)(c.Z,{size:"small",onClick:a,"aria-label":"Delete user",children:(0,s.jsx)(N.Z,{fontSize:"small"})})]})}var T=i(8094),E=i(9099),H=i(3675);function W(e){var n,i,s;let t=[e.firstName,e.lastName].filter(Boolean).join(" ")||e.email||"â€”";return{id:e.id,name:t,code:null!==(n=e.userNumber)&&void 0!==n?n:e.id,behaviour:"Good",suspended:null!==(i=e.suspended)&&void 0!==i&&i,picture:null!==(s=e.picture)&&void 0!==s?s:null}}function L(){var e,n,i,P,z;let N=(0,S.useRouter)(),I=(0,E.t)(e=>e.token),[M,L]=(0,y.useState)(""),[O,D]=(0,y.useState)("all"),[U,B]=(0,y.useState)(0),[V,_]=(0,y.useState)(1),[Y,A]=(0,y.useState)(!1),[X,F]=(0,y.useState)(null),[G,q]=(0,y.useState)(!1),[J,K]=(0,y.useState)([]),[Q,$]=(0,y.useState)(""),[ee,en]=(0,y.useState)(null),[ei,es]=(0,y.useState)(null),[et,er]=(0,y.useState)({firstName:"",lastName:"",picture:""}),[ea,el]=(0,y.useState)(!1),[eo,ed]=(0,y.useState)(0),{data:ec=[],isLoading:eu,isError:ex,error:em,refetch:eh,isFetching:ep}=(0,T.Rm)(),ef=(0,T.hV)(),eg=(0,T.Y7)();(0,y.useEffect)(()=>{ex&&!I&&N.replace("/")},[ex,I,N]);let ej=(0,y.useMemo)(()=>ec.map(W),[ec]),ev=(0,y.useMemo)(()=>{let e=ej;if("suspended"===O&&(e=e.filter(e=>e.suspended)),M.trim()){let n=M.trim().toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(n)||e.code.toLowerCase().includes(n))}return e},[ej,M,O]),eZ=Math.max(1,Math.ceil(ev.length/10)),eb=(V-1)*10,eC=ev.slice(eb,eb+10);return(0,y.useEffect)(()=>{if(!X)return;q(!0);let e=window.setTimeout(()=>{K([{id:1,sender:"user",text:"Hi, I need help with my loan approval.",time:"09:20"},{id:2,sender:"admin",text:"Sure, can you confirm your offline code?",time:"09:22"},{id:3,sender:"user",text:X.code,time:"09:23"}]),q(!1)},500);return()=>window.clearTimeout(e)},[X]),(0,s.jsxs)(l.Z,{component:k.E.div,initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.45,ease:"easeOut"},children:[(0,s.jsx)(w.Z,{search:M,onSearchChange:L}),(0,s.jsx)(l.Z,{sx:{background:"#ffffff",borderRadius:{xs:0,md:2},padding:{xs:2,md:3.5},paddingBottom:{xs:3,md:4},marginTop:{xs:2,md:3},marginX:{xs:-2,md:0},minHeight:"calc(100vh - 220px)",display:"flex",flexDirection:"column"},children:(0,s.jsx)(o.Z,{sx:{marginTop:"auto"},spacing:2,children:(0,s.jsxs)(l.Z,{sx:{borderRadius:3,padding:2,backgroundColor:"#f3f3f3",display:"flex",flexDirection:"column"},children:[(0,s.jsxs)(o.Z,{spacing:2,sx:{marginBottom:2,paddingTop:2,paddingLeft:2},children:[(0,s.jsxs)(o.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:1,children:[(0,s.jsx)(d.Z,{variant:"h6",sx:{fontWeight:700,marginTop:{xs:1,md:2}},children:"USERS"}),(0,s.jsx)(c.Z,{size:"small",onClick:()=>eh(),disabled:ep,"aria-label":"Refresh list",children:(0,s.jsx)(r.Z,{})})]}),(0,s.jsxs)(u.Z,{value:O,onChange:(e,n)=>{D(n),_(1)},sx:{minHeight:36,"& .MuiTab-root":{minHeight:36,textTransform:"none",fontWeight:600},"& .MuiTabs-indicator":{backgroundColor:"#0b7b4c"},"& .Mui-selected":{color:"#0b7b4c"}},children:[(0,s.jsx)(x.Z,{label:"All profiles",value:"all"}),(0,s.jsx)(x.Z,{label:"Suspended",value:"suspended"})]})]}),(0,s.jsxs)(l.Z,{sx:{fontSize:12,color:"text.secondary",marginBottom:2,backgroundColor:"#fff",borderRadius:999,paddingY:1.2,paddingX:3,display:{xs:"none",md:"grid"},gridTemplateColumns:{md:"2fr 1fr 1fr 0.9fr 80px"},alignItems:"center",gap:1},children:[(0,s.jsx)(l.Z,{children:"Name"}),(0,s.jsx)(l.Z,{children:"Offline code"}),(0,s.jsx)(l.Z,{children:"Behaviour"}),(0,s.jsx)(l.Z,{children:"Status"}),(0,s.jsx)(l.Z,{})]}),(0,s.jsx)(l.Z,{sx:{marginTop:1,maxHeight:{xs:420,sm:"none"},overflowY:{xs:"auto",sm:"visible"}},children:eu?(0,s.jsxs)(o.Z,{alignItems:"center",py:4,children:[(0,s.jsx)(m.Z,{sx:{color:"#0b7b4c"}}),(0,s.jsx)(d.Z,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Loading users..."})]}):ex?(0,s.jsxs)(o.Z,{alignItems:"center",py:4,spacing:2,children:[(0,s.jsx)(d.Z,{color:"error",children:em.message}),(0,s.jsx)(h.Z,{variant:"outlined",onClick:()=>eh(),size:"small",children:"Retry"})]}):(0,s.jsx)(o.Z,{spacing:0,children:eC.map((e,n)=>{var i,t;let r=eb+n;return(0,s.jsxs)(l.Z,{onClick:()=>B(r),sx:{paddingY:2,paddingX:{xs:2,md:3},borderBottom:n===eC.length-1?"none":"1px solid #fff",backgroundColor:U===r?"#ffffff":"transparent",display:{xs:"flex",md:"grid"},flexDirection:{xs:"column",md:"unset"},gridTemplateColumns:{md:"2fr 1fr 1fr 0.9fr 80px"},alignItems:"center",gap:{xs:1.5,md:1},cursor:"pointer",transition:"background-color 0.2s ease",borderRadius:1,outline:U===r?"1px solid #32b25c":"1px solid transparent",outlineOffset:"-1px","&:hover":{backgroundColor:"#ffffff",outline:"1px solid #32b25c"}},children:[(0,s.jsxs)(o.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,s.jsx)(p.Z,{src:e.picture||void 0,sx:{width:32,height:32},children:(null!==(t=null===(i=e.name)||void 0===i?void 0:i[0])&&void 0!==t?t:"?").toUpperCase()}),(0,s.jsx)(d.Z,{variant:"body2",children:e.name})]}),(0,s.jsxs)(l.Z,{sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsx)(d.Z,{variant:"caption",color:"text.secondary",sx:{display:{xs:"block",md:"none"}},children:"Offline code"}),(0,s.jsx)(d.Z,{variant:"body2",children:e.code})]}),(0,s.jsxs)(l.Z,{sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsx)(d.Z,{variant:"caption",color:"text.secondary",sx:{display:{xs:"block",md:"none"}},children:"Behaviour"}),U===r?(0,s.jsx)(l.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,s.jsx)(R,{isVisible:!0,suspended:e.suspended,onChatClick:()=>{F({id:e.id,name:e.name,code:e.code}),A(!0)},onEditClick:()=>{let n=ec.find(n=>n.id===e.id);if(n){var i,s,t;es(n),er({firstName:null!==(i=n.firstName)&&void 0!==i?i:"",lastName:null!==(s=n.lastName)&&void 0!==s?s:"",picture:null!==(t=n.picture)&&void 0!==t?t:""})}},onDeleteClick:()=>{en({id:e.id,name:e.name,code:e.code})},onSuspendClick:()=>{ef.mutate({id:e.id,payload:{suspended:!e.suspended}})}})}):(0,s.jsx)(d.Z,{variant:"body2",children:e.behaviour})]}),(0,s.jsx)(l.Z,{sx:{display:{xs:"none",md:"flex"},alignItems:"center"},children:(0,s.jsx)(d.Z,{variant:"body2",sx:{color:e.suspended?"error.main":"#0b7b4c",fontWeight:500},children:e.suspended?"Suspended":"Active"})}),(0,s.jsx)(l.Z,{sx:{display:{xs:"none",md:"block"}}})]},"".concat(e.id))})})}),(0,s.jsx)(o.Z,{alignItems:"center",sx:{marginTop:2},children:(0,s.jsx)(f.Z,{count:eZ,page:V,onChange:(e,n)=>{_(n),B((n-1)*10)},color:"primary"})})]})})}),(0,s.jsx)(g.ZP,{anchor:"right",open:Y,onClose:()=>{A(!1),$("")},PaperProps:{sx:{width:{xs:"100%",sm:360},padding:3}},children:(0,s.jsxs)(o.Z,{spacing:3,sx:{height:"100%"},children:[(0,s.jsxs)(o.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,s.jsxs)(o.Z,{spacing:.5,children:[(0,s.jsx)(d.Z,{variant:"h6",fontWeight:700,children:X?X.name:"User chat"}),(0,s.jsxs)(d.Z,{variant:"body2",color:"text.secondary",children:["User ID: ",null!==(P=null==X?void 0:X.id)&&void 0!==P?P:"--"]})]}),(0,s.jsx)(c.Z,{"aria-label":"Close chat",onClick:()=>{A(!1),$("")},children:(0,s.jsx)(t.Z,{})})]}),(0,s.jsx)(l.Z,{sx:{flex:1,backgroundColor:"#f3f3f3",borderRadius:1,padding:2,overflowY:"auto"},children:(0,s.jsx)(o.Z,{spacing:2,children:G?(0,s.jsx)(d.Z,{color:"text.secondary",children:"Loading chat..."}):J.map(e=>(0,s.jsxs)(l.Z,{sx:{alignSelf:"admin"===e.sender?"flex-end":"flex-start",backgroundColor:"admin"===e.sender?"#0b7b4c":"#ffffff",color:"admin"===e.sender?"#ffffff":"text.primary",padding:1.5,borderRadius:1,maxWidth:"80%"},children:[(0,s.jsx)(d.Z,{variant:"body2",children:e.text}),(0,s.jsx)(d.Z,{variant:"caption",sx:{opacity:.7},children:e.time})]},e.id))})}),(0,s.jsxs)(o.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,s.jsx)(j.Z,{fullWidth:!0,placeholder:"Type a message...",value:Q,onChange:e=>$(e.target.value),size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,backgroundColor:"#fff"}}}),(0,s.jsx)(c.Z,{color:"primary",onClick:()=>{if(!Q.trim())return;let e=new Date,n="".concat(e.getHours().toString().padStart(2,"0"),":").concat(e.getMinutes().toString().padStart(2,"0"));K(e=>[...e,{id:e.length+1,sender:"admin",text:Q.trim(),time:n}]),$("")},sx:{backgroundColor:"#0b7b4c",color:"#fff","&:hover":{backgroundColor:"#096b3d"}},children:(0,s.jsx)(a.Z,{})})]})]})}),(0,s.jsxs)(v.Z,{open:!!ee,onClose:()=>!eg.isPending&&en(null),PaperProps:{sx:{borderRadius:2}},children:[(0,s.jsx)(Z.Z,{children:"Delete user"}),(0,s.jsxs)(b.Z,{children:[(0,s.jsxs)(d.Z,{children:["Are you sure you want to delete"," ",(0,s.jsx)("strong",{children:null!==(z=null==ee?void 0:ee.name)&&void 0!==z?z:""}),"? Their wallet and loan history will also be deleted. This action cannot be undone."]}),eg.isError&&(0,s.jsx)(d.Z,{color:"error",sx:{mt:2},children:eg.error.message})]}),(0,s.jsxs)(C.Z,{sx:{px:3,pb:2},children:[(0,s.jsx)(h.Z,{onClick:()=>en(null),disabled:eg.isPending,children:"Cancel"}),(0,s.jsx)(h.Z,{variant:"contained",color:"error",disabled:eg.isPending,onClick:()=>{ee&&eg.mutate(ee.id,{onSuccess:()=>{en(null),B(-1)}})},children:eg.isPending?"Deleting...":"Delete"})]})]}),(0,s.jsxs)(v.Z,{open:!!ei,onClose:()=>!ef.isPending&&es(null),PaperProps:{sx:{borderRadius:2,minWidth:360}},maxWidth:"sm",fullWidth:!0,children:[(0,s.jsx)(Z.Z,{children:"Edit user"}),(0,s.jsx)(b.Z,{children:(0,s.jsxs)(o.Z,{spacing:2,sx:{pt:1},children:[(0,s.jsxs)(o.Z,{alignItems:"center",spacing:1,children:[(0,s.jsx)(p.Z,{src:et.picture||void 0,sx:{width:80,height:80},children:((null===(e=et.firstName)||void 0===e?void 0:e[0])||(null===(n=et.lastName)||void 0===n?void 0:n[0])||(null==ei?void 0:null===(i=ei.email)||void 0===i?void 0:i[0])||"?").toUpperCase()}),(0,s.jsx)(d.Z,{variant:"caption",color:"text.secondary",children:null==ei?void 0:ei.email}),(0,s.jsx)("input",{type:"file",accept:"image/*",style:{display:"none"},id:"edit-user-image-upload",onChange:async e=>{var n;let i=null===(n=e.target.files)||void 0===n?void 0:n[0];if(i&&ei){el(!0);try{let e=await (0,H.Ix)(i,{folder:"stillplay/avatars",token:I});er(n=>({...n,picture:e.secureUrl})),ef.mutate({id:ei.id,payload:{picture:e.secureUrl}},{onSuccess:()=>{es(n=>n?{...n,picture:e.secureUrl}:null)}})}catch(e){console.error(e)}finally{el(!1),ed(e=>e+1)}}}},eo),(0,s.jsx)(h.Z,{size:"small",variant:"outlined",component:"label",htmlFor:"edit-user-image-upload",disabled:ea||ef.isPending,sx:{mt:.5},children:ea?"Uploading...":ef.isPending?"Saving...":"Upload image"})]}),(0,s.jsx)(j.Z,{label:"First name",value:et.firstName,onChange:e=>er(n=>({...n,firstName:e.target.value})),fullWidth:!0,size:"small"}),(0,s.jsx)(j.Z,{label:"Last name",value:et.lastName,onChange:e=>er(n=>({...n,lastName:e.target.value})),fullWidth:!0,size:"small"}),ef.isError&&(0,s.jsx)(d.Z,{color:"error",variant:"body2",children:ef.error.message})]})}),(0,s.jsxs)(C.Z,{sx:{px:3,pb:2},children:[(0,s.jsx)(h.Z,{onClick:()=>es(null),disabled:ef.isPending,children:"Cancel"}),(0,s.jsx)(h.Z,{variant:"contained",disabled:ef.isPending,onClick:()=>{ei&&ef.mutate({id:ei.id,payload:{firstName:et.firstName.trim()||void 0,lastName:et.lastName.trim()||void 0,picture:et.picture.trim()||void 0}},{onSuccess:()=>es(null)})},sx:{backgroundColor:"#0b7b4c"},children:ef.isPending?"Saving...":"Save"})]})]})]})}},8243:function(e,n,i){"use strict";i.d(n,{Z:function(){return d}});var s=i(7437),t=i(9869),r=i(8984),a=i(7404),l=i(3996),o=i(1899);function d(e){let{search:n,onSearchChange:i}=e;return(0,s.jsxs)(r.Z,{direction:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"center"},justifyContent:"space-between",spacing:2,sx:{marginBottom:3},children:[(0,s.jsx)(a.Z,{placeholder:"Search",value:n,onChange:e=>i(e.target.value),InputProps:{startAdornment:(0,s.jsx)(l.Z,{position:"start",children:(0,s.jsx)(t.Z,{sx:{color:"#97a6a0"}})})},sx:{width:{xs:"100%",sm:320,md:380},alignSelf:{xs:"stretch",md:"flex-start"},"& .MuiOutlinedInput-root":{backgroundColor:"#f3f3f3",borderRadius:999,"& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"}}}}),(0,s.jsx)(o.Z,{})]})}},3279:function(e,n,i){"use strict";var s=i(9973);n.Z=void 0;var t=s(i(9815)),r=i(7437);n.Z=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block")},4061:function(e,n,i){"use strict";var s=i(9973);n.Z=void 0;var t=s(i(9815)),r=i(7437);n.Z=(0,t.default)((0,r.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H6l-2 2V4h16z"}),"ChatBubbleOutline")},1705:function(e,n,i){"use strict";var s=i(9973);n.Z=void 0;var t=s(i(9815)),r=i(7437);n.Z=(0,t.default)((0,r.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close")},7801:function(e,n,i){"use strict";var s=i(9973);n.Z=void 0;var t=s(i(9815)),r=i(7437);n.Z=(0,t.default)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline")},735:function(e,n,i){"use strict";var s=i(9973);n.Z=void 0;var t=s(i(9815)),r=i(7437);n.Z=(0,t.default)((0,r.jsx)("path",{d:"m14.06 9.02.92.92L5.92 19H5v-.92zM17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29m-3.6 3.19L3 17.25V21h3.75L17.81 9.94z"}),"EditOutlined")},1052:function(e,n,i){"use strict";var s=i(9973);n.Z=void 0;var t=s(i(9815)),r=i(7437);n.Z=(0,t.default)((0,r.jsx)("path",{d:"M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 12H6V10h12z"}),"LockOpen")},9993:function(e,n,i){"use strict";var s=i(9973);n.Z=void 0;var t=s(i(9815)),r=i(7437);n.Z=(0,t.default)((0,r.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send")},9376:function(e,n,i){"use strict";var s=i(5475);i.o(s,"usePathname")&&i.d(n,{usePathname:function(){return s.usePathname}}),i.o(s,"useRouter")&&i.d(n,{useRouter:function(){return s.useRouter}}),i.o(s,"useSearchParams")&&i.d(n,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[165,43,498,262,404,49,135,713,378,549,958,253,94,971,117,744],function(){return e(e.s=2198)}),_N_E=e.O()}]);