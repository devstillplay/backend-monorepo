(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{72592:function(e,n,t){Promise.resolve().then(t.bind(t,32489))},32489:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return x}});var r=t(57437),i=t(8984),a=t(1899),s=t(5002),l=t(94013),u=t(82279),o=t(21770),c=t(99376),d=t(2265),y=t(36596),f=t(22603),m=t(53675),g=t(58094),p=t(9099),v=t(88219);function h(){var e;let n=(0,c.useRouter)(),t=null!==(e=(0,c.useSearchParams)().get("flow"))&&void 0!==e?e:"login",{otpEmail:h,otpExpiresAt:x,status:b,setAuthenticated:q,setPendingOtp:k,reset:S,fullName:j}=(0,p.t)(),K=(0,v.LM)(e=>e.setProfile),F=(0,v.LM)(e=>e.reset),[Z,_]=(0,d.useState)(""),[w,I]=(0,d.useState)(0),[L,Q]=(0,d.useState)("idle");(0,d.useEffect)(()=>{if("authenticated"===b){n.replace("/dashboard");return}if("otp_required"!==b){n.replace("/");return}let e=setInterval(()=>{let e=Math.max(0,(null!=x?x:0)-Date.now());I(e),0===e&&(S(),F())},1e3);return()=>clearInterval(e)},[x,S,F,n,b]);let C=(0,d.useMemo)(()=>{let e=Math.floor(w/1e3),n=String(Math.floor(e/60)).padStart(2,"0"),t=String(e%60).padStart(2,"0");return"".concat(n,":").concat(t)},[w]),T=(0,o.D)({mutationFn:()=>(0,m.VP)({type:"register"===t?"register":"login",email:null!=h?h:"",code:Z}),onSuccess:e=>{var t;let r=e.user?{id:e.user.id,email:e.user.email,role:e.user.role,firstName:e.user.firstName,lastName:e.user.lastName,picture:null!==(t=e.user.picture)&&void 0!==t?t:null}:{id:"",email:null!=h?h:"",role:"admin",firstName:null==j?void 0:j.split(" ")[0],lastName:null==j?void 0:j.split(" ").slice(1).join(" ")};q(e.token,r),K({...r}),(0,g.bA)({action:"Logged in"}),sessionStorage.removeItem("__otp_resend_email"),sessionStorage.removeItem("__otp_resend_pw"),n.push("/dashboard")}}),N=(0,d.useCallback)(async()=>{var e,r;if(!h)return;let i=null!==(e=sessionStorage.getItem("__otp_resend_email"))&&void 0!==e?e:h,a=null!==(r=sessionStorage.getItem("__otp_resend_pw"))&&void 0!==r?r:"";if(!a){n.push("/");return}Q("sending"),_("");try{await (0,m.ho)({type:"register"===t?"register":"login",email:i,password:a}),k(i,Date.now()+6e5),Q("sent"),setTimeout(()=>Q("idle"),4e3)}catch(e){Q("error"),setTimeout(()=>Q("idle"),4e3)}},[h,t,k,n]),O=(0,d.useCallback)((e,n)=>(0,r.jsx)("input",{...e,style:{width:56,height:56,textAlign:"center",fontSize:20,fontWeight:600,border:"none",borderRadius:8,backgroundColor:"#f2f2f2",outline:"none"}}),[]);return(0,r.jsx)(f.Z,{children:(0,r.jsxs)(i.Z,{spacing:3,sx:{width:"100%",alignItems:"center"},children:[(0,r.jsxs)(a.Z,{children:[(0,r.jsx)(s.Z,{variant:"h4",children:"OTP"}),(0,r.jsx)(s.Z,{variant:"body2",sx:{color:"text.secondary"},children:"We've sent you a 4-digit code to your email."})]}),(0,r.jsx)(a.Z,{component:"form",onSubmit:e=>{e.preventDefault(),h&&4===Z.length&&T.mutate()},children:(0,r.jsxs)(i.Z,{spacing:3,alignItems:"center",children:[(0,r.jsx)(y.Z,{value:Z,onChange:_,numInputs:4,renderInput:O,inputType:"tel",shouldAutoFocus:!0,containerStyle:{gap:12}}),(0,r.jsxs)(i.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,r.jsxs)(s.Z,{variant:"body2",color:"text.secondary",children:["Code expires in ",C]}),(0,r.jsx)(l.Z,{variant:"text",color:"error"===L?"error":"secondary",size:"small",disabled:"sending"===L,onClick:N,children:"sending"===L?"Sending...":"sent"===L?"Code sent ✓":"error"===L?"Failed — try again":"Send again"})]}),T.isError?(0,r.jsx)(u.Z,{severity:"error",children:T.error.message}):null,(0,r.jsx)(l.Z,{type:"submit",variant:"contained",size:"large",disabled:T.isPending||4!==Z.length,sx:{backgroundColor:"#0b7b4c"},children:T.isPending?"Verifying...":"Confirm"})]})})]})})}function x(){return(0,r.jsx)(d.Suspense,{fallback:(0,r.jsx)(f.Z,{children:(0,r.jsx)(a.Z,{sx:{py:4,textAlign:"center"},children:(0,r.jsx)(s.Z,{color:"text.secondary",children:"Loading..."})})}),children:(0,r.jsx)(h,{})})}},22603:function(e,n,t){"use strict";t.d(n,{Z:function(){return l}});var r=t(57437),i=t(1899),a=t(44236);function s(){return(0,r.jsx)(i.Z,{component:a.E.div,initial:{backgroundPosition:"0% 50%"},animate:{backgroundPosition:["0% 50%","100% 50%","0% 50%"]},transition:{duration:7,repeat:1/0,ease:"linear"},sx:{position:"relative",display:{xs:"none",md:"flex"},alignItems:"center",justifyContent:"center",backgroundImage:"linear-gradient(135deg, #f0b12a 0%, #0b7b4c 55%, #f0b12a 100%)",backgroundSize:"200% 200%"},children:(0,r.jsx)(i.Z,{component:a.E.img,src:"/assets/svg/STILL PLAYLOGOWH.svg",alt:"Still Play",initial:{opacity:0,y:12,scale:.98},animate:{opacity:1,y:0,scale:1},transition:{duration:.6,ease:"easeOut"},sx:{width:{xs:140,md:180},height:"auto"}})})}function l(e){let{children:n}=e;return(0,r.jsx)(i.Z,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:0},children:(0,r.jsxs)(i.Z,{sx:{width:"100%",minHeight:"100vh",background:"#fff",borderRadius:0,overflow:"hidden",display:"grid",gridTemplateColumns:{xs:"1fr",md:"40% 60%"}},children:[(0,r.jsx)(s,{}),(0,r.jsx)(i.Z,{sx:{padding:{xs:3,md:6},display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(i.Z,{component:a.E.div,initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},sx:{width:"100%",maxWidth:680},children:n})})]})})}},58094:function(e,n,t){"use strict";t.d(n,{Cx:function(){return x},HI:function(){return k},Hv:function(){return w},It:function(){return q},OL:function(){return h},P7:function(){return S},RB:function(){return F},Rm:function(){return c},XO:function(){return d},Xl:function(){return K},Y7:function(){return g},Yn:function(){return I},bA:function(){return m},cy:function(){return Z},ez:function(){return v},hV:function(){return y},ko:function(){return p},l2:function(){return b},pv:function(){return j},ur:function(){return _},yf:function(){return f}});var r=t(11713),i=t(29827),a=t(21770),s=t(9099),l=t(53675);let u={all:["admin"],users:()=>[...u.all,"users"],user:e=>[...u.users(),e],employees:()=>[...u.all,"employees"],activity:()=>[...u.all,"activity"],settings:()=>[...u.all,"settings"],loans:{all:()=>[...u.all,"loans","all"],allRepayments:()=>[...u.all,"loans","repayments","all"],userLoans:e=>[...u.all,"loans","user",e],userRepayments:e=>[...u.all,"loans","repayments","user",e],userWallet:e=>[...u.all,"loans","wallet",e],userEligibility:e=>[...u.all,"loans","eligibility",e]}},o={all:["providers"],list:()=>[...o.all,"list"]};function c(){let e=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:u.users(),queryFn:()=>(0,l.zO)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:6e4})}function d(e){let n=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:[...u.users(),"detail",e],queryFn:()=>(0,l.eJ)(n,e),enabled:!!n&&!!e,staleTime:3e4})}function y(){let e=(0,s.t)(e=>e.token),n=(0,i.NL)();return(0,a.D)({mutationFn:n=>{let{id:t,payload:r}=n;return(0,l.vr)(e,t,r)},onSuccess:()=>{n.invalidateQueries({queryKey:u.users()}),m({action:"User edited"}),n.invalidateQueries({queryKey:u.activity()})}})}function f(e){let n=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:[...u.activity(),null!=e?e:50],queryFn:()=>(0,l.Cy)(n,e),enabled:!!n,staleTime:3e4})}function m(e){let n=s.t.getState().token;n&&(0,l.BX)(n,e).catch(()=>{})}function g(){let e=(0,s.t)(e=>e.token),n=(0,i.NL)();return(0,a.D)({mutationFn:n=>(0,l.Er)(e,n),onSuccess:()=>{n.invalidateQueries({queryKey:u.users()}),m({action:"User deleted"}),n.invalidateQueries({queryKey:u.activity()})}})}function p(){let e=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:o.list(),queryFn:()=>(0,l.xp)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:6e4})}function v(){let e=(0,s.t)(e=>e.token),n=(0,i.NL)();return(0,a.D)({mutationFn:n=>(0,l.Qz)(e,n),onSuccess:()=>{n.invalidateQueries({queryKey:o.list()}),m({action:"Provider added"}),n.invalidateQueries({queryKey:u.activity()})}})}function h(){let e=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:u.employees(),queryFn:()=>(0,l.vG)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:6e4})}function x(){let e=(0,s.t)(e=>e.token),n=(0,i.NL)();return(0,a.D)({mutationFn:n=>(0,l.r8)(e,n),onSuccess:()=>{n.invalidateQueries({queryKey:u.employees()}),m({action:"Staff/employee created"}),n.invalidateQueries({queryKey:u.activity()})}})}function b(e){let n=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:u.loans.userLoans(null!=e?e:""),queryFn:()=>(0,l.hJ)(n,e),enabled:!!n&&!!e,staleTime:3e4})}function q(e){let n=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:u.loans.userRepayments(null!=e?e:""),queryFn:()=>(0,l.Rt)(n,e),enabled:!!n&&!!e,staleTime:3e4})}function k(e){let n=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:u.loans.userWallet(null!=e?e:""),queryFn:()=>(0,l.p0)(n,e),enabled:!!n&&!!e,staleTime:3e4})}function S(e){let n=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:u.loans.userEligibility(null!=e?e:""),queryFn:()=>(0,l.Hd)(n,e),enabled:!!n&&!!e,staleTime:15e3})}function j(){let e=(0,s.t)(e=>e.token),n=(0,i.NL)();return(0,a.D)({mutationFn:n=>(0,l.G7)(e,n),onSuccess:(e,t)=>{n.invalidateQueries({queryKey:u.loans.userLoans(t.userId)}),n.invalidateQueries({queryKey:u.loans.userWallet(t.userId)}),n.invalidateQueries({queryKey:u.loans.userRepayments(t.userId)}),n.invalidateQueries({queryKey:u.loans.userEligibility(t.userId)}),n.invalidateQueries({queryKey:u.loans.all()}),n.invalidateQueries({queryKey:u.loans.allRepayments()})}})}function K(){let e=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:u.loans.all(),queryFn:()=>(0,l.cA)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:3e4})}function F(){let e=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:u.loans.allRepayments(),queryFn:()=>(0,l.Cb)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:3e4})}function Z(){let e=(0,s.t)(e=>e.token),n=(0,i.NL)();return(0,a.D)({mutationFn:n=>(0,l.xl)(e,n),onSuccess:()=>{n.invalidateQueries({queryKey:u.loans.all()}),m({action:"Loan approved"}),n.invalidateQueries({queryKey:u.activity()})}})}function _(){let e=(0,s.t)(e=>e.token),n=(0,i.NL)();return(0,a.D)({mutationFn:n=>(0,l.ey)(e,n),onSuccess:()=>{n.invalidateQueries({queryKey:u.loans.all()}),m({action:"Loan rejected"}),n.invalidateQueries({queryKey:u.activity()})}})}function w(){let e=(0,s.t)(e=>e.token);return(0,r.a)({queryKey:u.settings(),queryFn:()=>(0,l.hO)(e),enabled:!!e,staleTime:6e4})}function I(){let e=(0,s.t)(e=>e.token),n=(0,i.NL)();return(0,a.D)({mutationFn:n=>{let{key:t,value:r}=n;return(0,l.WD)(e,t,r)},onSuccess:()=>{n.invalidateQueries({queryKey:u.settings()})}})}}},function(e){e.O(0,[515,330,262,140,236,713,9,675,971,117,744],function(){return e(e.s=72592)}),_N_E=e.O()}]);