"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[94],{3675:function(e,t,r){function n(){return"http://localhost:3000/api".replace(/\/$/,"")}function a(){if(!n())throw Error("API URL not configured. Add NEXT_PUBLIC_API_BASE_URL to .env.local (e.g. http://localhost:3000/api) and restart the dev server.")}r.d(t,{jY:function(){return L},zN:function(){return T},r8:function(){return J},Qz:function(){return z},Er:function(){return S},WN:function(){return F},o3:function(){return b},Cy:function(){return k},zO:function(){return C},vG:function(){return x},xp:function(){return R},BX:function(){return E},ho:function(){return O},f8:function(){return P},c0:function(){return j},C_:function(){return I},vr:function(){return v},Ix:function(){return _},VP:function(){return q}});let o=()=>"".concat(n(),"/auth/request-code"),s=()=>"".concat(n(),"/auth/verify-code"),i=()=>"".concat(n(),"/auth/forgot-password"),u=()=>"".concat(n(),"/auth/reset-password"),l=()=>"".concat(n(),"/admin/users"),c=e=>"".concat(n(),"/admin/users/").concat(e),f=()=>"".concat(n(),"/admin/employees"),d=()=>"".concat(n(),"/admin/activity"),y=()=>"".concat(n(),"/providers"),h=()=>"".concat(n(),"/providers"),g=()=>"".concat(n(),"/files/upload");var m=r(9099),p=r(8219);function w(e){let t={"Content-Type":"application/json"};return e&&(t.Authorization="Bearer ".concat(e)),t}function A(e){401===e.status&&(m.t.getState().reset(),p.LM.getState().reset())}async function v(e,t,r){let n=await fetch(c(t),{method:"PATCH",headers:w(e),body:JSON.stringify(r)}),a=await n.json().catch(()=>({}));if(!n.ok)throw A(n),Error("string"==typeof a.message?a.message:Array.isArray(a.message)?a.message[0]:"Failed to update user");return a}async function S(e,t){let r=await fetch(c(t),{method:"DELETE",headers:w(e)}),n=await r.json().catch(()=>({}));if(!r.ok)throw A(r),Error("string"==typeof n.message?n.message:Array.isArray(n.message)?n.message[0]:"Failed to delete user");return n}async function E(e,t){let r=await fetch(d(),{method:"POST",headers:w(e),body:JSON.stringify(t)}),n=await r.json().catch(()=>({}));if(!r.ok)throw A(r),Error("string"==typeof n.message?n.message:Array.isArray(n.message)?n.message[0]:"Failed to record activity");return n}async function k(e,t){let r=new URL(d());null!=t&&r.searchParams.set("limit",String(t));let n=await fetch(r.toString(),{headers:w(e)}),a=await n.json().catch(()=>({}));if(!n.ok)throw A(n),Error("string"==typeof a.message?a.message:"Failed to load activity");return a}let L=["Super Admin","Finance","Customer Support","Operations","Legal & Compliance","Auditor"];function F(e){var t,r;let n=null!==(t=e.agreedAmount)&&void 0!==t?t:null;return null==n||n<=0?null:Math.round(n*(1+(null!==(r=e.percentageToAdd)&&void 0!==r?r:0)/100)*100)/100}async function O(e){let t=await fetch(o(),{method:"POST",headers:w(),body:JSON.stringify(e)}),r=await t.json().catch(()=>({}));if(!t.ok)throw Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Failed to send code");return r}let N="stillplay_reset_token";async function P(e){a();let t=await fetch(i(),{method:"POST",headers:w(),body:JSON.stringify({email:e.trim()})}),r=await t.json().catch(()=>({}));if(!t.ok)throw Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Failed to send reset code");return r}function b(){return sessionStorage.getItem(N)}function I(e){sessionStorage.setItem(N,e)}function T(){sessionStorage.removeItem(N)}async function _(e,t){a();let r=new FormData;r.append("file",e),(null==t?void 0:t.folder)&&r.append("folder",t.folder);let n={};(null==t?void 0:t.token)&&(n.Authorization="Bearer ".concat(t.token));let o=await fetch(g(),{method:"POST",headers:n,body:r}),s=await o.json().catch(()=>({}));if(!o.ok){var i;throw Error("string"==typeof s.message?s.message:null!==(i=s.error)&&void 0!==i?i:"Upload failed")}if(s&&"object"==typeof s&&"error"in s)throw Error(s.error);return s}async function j(e){a();let t=await fetch(u(),{method:"POST",headers:w(),body:JSON.stringify(e)}),r=await t.json().catch(()=>({}));if(!t.ok)throw Error("string"==typeof r.message?r.message:Array.isArray(r.message)?r.message[0]:"Failed to reset password");return r}async function q(e){a();let t=await fetch(s(),{method:"POST",headers:w(),body:JSON.stringify(e)}),r=await t.text(),n={};try{n=r?JSON.parse(r):{}}catch(e){if(r.trimStart().startsWith("<!"))throw Error("Received a web page instead of API. Set NEXT_PUBLIC_API_BASE_URL in .env.local to your API gateway (e.g. http://localhost:3000/api) and restart.");throw Error(r.slice(0,120)||"Invalid or expired code")}if(!t.ok)throw Error("string"==typeof n.message?n.message:Array.isArray(n.message)?n.message[0]:"Invalid or expired code");return n}async function C(e){var t;let r=await fetch(l(),{headers:w(e)}),n=await r.json().catch(()=>({}));if(!r.ok)throw A(r),Error("string"==typeof n.message?n.message:"Failed to load users");return Array.isArray(n)?n:null!==(t=n.users)&&void 0!==t?t:[]}async function x(e){var t;let r=await fetch(f(),{headers:w(e)}),n=await r.json().catch(()=>({}));if(!r.ok)throw A(r),Error("string"==typeof n.message?n.message:"Failed to load staff");return Array.isArray(n)?n:null!==(t=n.employees)&&void 0!==t?t:[]}async function J(e,t){let r=await fetch(f(),{method:"POST",headers:w(e),body:JSON.stringify(t)}),n=await r.json().catch(()=>({}));if(!r.ok)throw A(r),Error("string"==typeof n.message?n.message:Array.isArray(n.message)?n.message[0]:"Failed to create staff");return n}async function R(e){var t;let r=await fetch(y(),{headers:w(e)}),n=await r.json().catch(()=>({}));if(!r.ok)throw A(r),Error("string"==typeof n.message?n.message:"Failed to load providers");return Array.isArray(n)?n:null!==(t=n.providers)&&void 0!==t?t:[]}async function z(e,t){let r=await fetch(h(),{method:"POST",headers:w(e),body:JSON.stringify(t)}),n=await r.json().catch(()=>({}));if(!r.ok)throw A(r),Error("string"==typeof n.message?n.message:Array.isArray(n.message)?n.message[0]:"Failed to create provider");return n}},8094:function(e,t,r){r.d(t,{Cx:function(){return w},OL:function(){return p},Rm:function(){return c},Y7:function(){return h},bA:function(){return y},ez:function(){return m},hV:function(){return f},ko:function(){return g},yf:function(){return d}});var n=r(1713),a=r(9827),o=r(1770),s=r(9099),i=r(3675);let u={all:["admin"],users:()=>[...u.all,"users"],user:e=>[...u.users(),e],employees:()=>[...u.all,"employees"],activity:()=>[...u.all,"activity"]},l={all:["providers"],list:()=>[...l.all,"list"]};function c(){let e=(0,s.t)(e=>e.token);return(0,n.a)({queryKey:u.users(),queryFn:()=>(0,i.zO)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:6e4})}function f(){let e=(0,s.t)(e=>e.token),t=(0,a.NL)();return(0,o.D)({mutationFn:t=>{let{id:r,payload:n}=t;return(0,i.vr)(e,r,n)},onSuccess:()=>{t.invalidateQueries({queryKey:u.users()})}})}function d(e){let t=(0,s.t)(e=>e.token);return(0,n.a)({queryKey:[...u.activity(),null!=e?e:50],queryFn:()=>(0,i.Cy)(t,e),enabled:!!t,staleTime:3e4})}function y(e){let t=s.t.getState().token;t&&(0,i.BX)(t,e).catch(()=>{})}function h(){let e=(0,s.t)(e=>e.token),t=(0,a.NL)();return(0,o.D)({mutationFn:t=>(0,i.Er)(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:u.users()})}})}function g(){let e=(0,s.t)(e=>e.token);return(0,n.a)({queryKey:l.list(),queryFn:()=>(0,i.xp)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:6e4})}function m(){let e=(0,s.t)(e=>e.token),t=(0,a.NL)();return(0,o.D)({mutationFn:t=>(0,i.Qz)(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:l.list()})}})}function p(){let e=(0,s.t)(e=>e.token);return(0,n.a)({queryKey:u.employees(),queryFn:()=>(0,i.vG)(e),enabled:!!e,refetchOnWindowFocus:!0,staleTime:6e4})}function w(){let e=(0,s.t)(e=>e.token),t=(0,a.NL)();return(0,o.D)({mutationFn:t=>(0,i.r8)(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:u.employees()})}})}},9099:function(e,t,r){r.d(t,{t:function(){return i}});var n=r(9625),a=r(6885),o=r(8219);let s={status:"unauthenticated",token:null,user:null,otpEmail:null,otpExpiresAt:null,fullName:null,_hasRehydrated:!1,lastLoginAt:null,lastLoginIp:null,lastAction:null},i=(0,n.Ue)()((0,a.tJ)(e=>({...s,setPendingOtp:(t,r,n)=>e({status:"otp_required",otpEmail:t,otpExpiresAt:r,fullName:null!=n?n:null}),setAuthenticated:(t,r)=>e({status:"authenticated",token:t,user:r,otpEmail:null,otpExpiresAt:null,lastLoginAt:Date.now()}),setUser:t=>e({user:t}),setRehydrated:()=>e({_hasRehydrated:!0}),setLastAction:t=>e({lastAction:t}),setLastLoginIp:t=>e({lastLoginIp:t}),reset:()=>e(s)}),{name:"stillplay-admin-auth",storage:(0,a.FL)(()=>localStorage),partialize:e=>({status:e.status,token:e.token,user:e.user,fullName:e.fullName,otpEmail:e.otpEmail,otpExpiresAt:e.otpExpiresAt,lastLoginAt:e.lastLoginAt,lastLoginIp:e.lastLoginIp,lastAction:e.lastAction}),onRehydrateStorage:()=>()=>{let e=i.getState();e.setRehydrated(),e.user&&o.LM.getState().setProfile(e.user)}}))},8219:function(e,t,r){r.d(t,{LM:function(){return o}});var n=r(9625),a=r(6885);let o=(0,n.Ue)()((0,a.tJ)(e=>({profile:null,setProfile:t=>e({profile:t}),reset:()=>e({profile:null})}),{name:"stillplay-admin-user",storage:(0,a.FL)(()=>localStorage),partialize:e=>({profile:e.profile})}))}}]);